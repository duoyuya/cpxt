<!DOCTYPE html>
<html lang="zh" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è½¦ç‰Œç®¡ç†ç³»ç»Ÿ - åå°ç®¡ç†</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f4f6f9;
      --card-bg: #ffffff;
      --text: #2c3e50;
      --text-secondary: #7f8c8d;
      --border: #dcdfe6;
      --primary: #007bff;
      --primary-hover: #0056b3;
      --primary-light: #e6f0ff;
      --danger: #dc3545;
      --danger-hover: #c82333;
      --success: #28a745;
      --success-light: #f0fff4;
      --warning: #ffc107;
      --shadow: 0 4px 12px rgba(0,0,0,0.1);
      --radius: 12px;
      --transition: all 0.3s ease;
    }
    
    [data-theme="dark"] {
      --bg: #1a1a1a;
      --card-bg: #2d2d2d;
      --text: #ecf0f1;
      --text-secondary: #95a5a6;
      --border: #444;
      --primary: #0d6efd;
      --primary-hover: #0b5ed7;
      --primary-light: #1a365d;
      --danger: #ea4b4b;
      --danger-hover: #e02d2d;
      --success-light: #0f3413;
      --shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      transition: var(--transition);
      min-height: 100vh;
      padding: 20px;
      position: relative;
    }
    
    /* ç³»ç»Ÿæ ‡é¢˜ */
    .system-title {
      display: flex;
      align-items: center;
      font-size: 24px;
      color: var(--primary);
      margin-bottom: 20px;
      padding: 15px;
      background-color: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    
    .system-title i {
      margin-right: 10px;
      font-size: 28px;
    }
    
    /* é¡µé¢å¯¼èˆªæ ‡é¢˜ */
    .page-title { 
      font-size: 20px; 
      color: var(--primary); 
      border-bottom: 2px solid var(--primary); 
      padding-bottom: 8px; 
      margin-bottom: 20px; 
      display: inline-block; 
    }
    
    /* åŠŸèƒ½åŒºå—æ ‡é¢˜ */
    .section-title { 
      background-color: var(--primary-light); 
      color: var(--primary); 
      padding: 12px 15px; 
      border-radius: var(--radius); 
      font-size: 18px; 
      margin-bottom: 20px; 
    }
    
    /* æç¤ºæ¶ˆæ¯ */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      border-radius: 8px;
      z-index: 9999;
      box-shadow: var(--shadow);
      display: none;
      max-width: 90%;
      text-align: center;
      color: white;
      animation: slideUp 0.3s ease-out forwards;
    }
    
    .toast-error {
      background: var(--danger);
    }
    
    .toast-success {
      background: var(--success);
    }
    
    .toast-info {
      background: var(--primary);
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translate(-50%, 20px);
      }
      to {
        opacity: 1;
        transform: translate(-50%, 0);
      }
    }
    
    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
    }
    
    .header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      padding: 16px 20px; 
      background: var(--card-bg); 
      border-radius: var(--radius); 
      box-shadow: var(--shadow); 
      margin-bottom: 24px; 
      flex-wrap: wrap; 
      gap: 12px; 
    }
    
    .logo { 
      font-size: 20px; 
      font-weight: bold; 
      color: var(--primary); 
      display: flex; 
      align-items: center; 
      gap: 8px; 
    }
    
    .logo i { 
      font-size: 24px; 
    }
    
    .welcome { 
      font-size: 16px; 
      color: var(--text-secondary); 
    }
    
    .controls { 
      display: flex; 
      gap: 10px; 
      flex-wrap: wrap; 
    }
    
    .btn { 
      padding: 10px 18px; 
      border: none; 
      border-radius: 8px; 
      font-size: 14px; 
      font-weight: bold; 
      cursor: pointer; 
      transition: var(--transition); 
      display: flex; 
      align-items: center; 
      gap: 6px; 
    }
    
    .btn i { 
      font-size: 16px; 
    }
    
    .btn-primary { 
      background: var(--primary); 
      color: white; 
    }
    
    .btn-primary:hover { 
      background: var(--primary-hover); 
    }
    
    .btn-danger { 
      background: var(--danger); 
      color: white; 
    }
    
    .btn-danger:hover { 
      background: var(--danger-hover); 
    }
    
    .btn-theme { 
      background: var(--border); 
      color: var(--text); 
      font-size: 16px; 
      padding: 10px; 
    }
    
    .btn-theme:hover { 
      background: #e0e0e0; 
    }
    
    [data-theme="dark"] .btn-theme:hover { 
      background: #555; 
    }
    
    .card { 
      background: var(--card-bg); 
      border-radius: var(--radius); 
      box-shadow: var(--shadow); 
      overflow: hidden; 
      margin-bottom: 24px; 
      transition: var(--transition); 
      position: relative; 
      z-index: 1; 
    }
    
    .card-header { 
      padding: 16px 20px; 
      background: var(--primary-light); 
      border-bottom: 1px solid var(--border); 
      font-weight: bold; 
      color: var(--primary); 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
    }
    
    .card-header h2 { 
      font-size: 18px; 
      font-weight: bold; 
    }
    
    .card-body { 
      padding: 20px; 
    }
    
    .search-container { 
      margin-bottom: 20px; 
    }
    
    .search-input-group { 
      display: flex; 
      gap: 10px; 
    }
    
    .log-actions { 
      display: flex; 
      gap: 10px; 
      margin-bottom: 15px; 
      align-items: center; 
      flex-wrap: wrap; 
    }
    
    .log-actions input[type="checkbox"] { 
      width: 16px; 
      height: 16px; 
      margin-right: 5px; 
    }
    
    input[type="text"], input[type="password"], select { 
      flex: 1; 
      padding: 10px 14px; 
      border: 1px solid var(--border); 
      border-radius: 8px; 
      background: var(--bg); 
      color: var(--text); 
      font-size: 14px; 
      transition: var(--transition); 
    }
    
    input[type="text"]:focus, input[type="password"]:focus, select:focus { 
      outline: none; 
      border-color: var(--primary); 
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2); 
    }
    
    /* è½¦ç‰Œå·è¾“å…¥å®¹å™¨ - ä¼˜åŒ–ç‰ˆ */
    .plate-input-container { 
      display: flex; 
      gap: 10px; 
      align-items: stretch; 
      margin-bottom: 10px; 
    }
    
    .plate-input-container select,
    .plate-input-container input { 
      height: 42px; /* ç»Ÿä¸€é«˜åº¦ */ 
    }
    
    .province-select { 
      width: 120px; /* çœä»½é€‰æ‹©æ¡†å›ºå®šå®½åº¦ */ 
    }
    
    .city-letter-select { 
      width: 180px; /* å­—æ¯é€‰æ‹©æ¡†å›ºå®šå®½åº¦ï¼Œå¢åŠ å®½åº¦ä»¥æ˜¾ç¤ºåŸå¸‚åç§° */ 
    }
    
    .remaining-number-input { 
      flex: 1; /* å‰©ä½™éƒ¨åˆ†å æ»¡å‰©ä½™ç©ºé—´ */ 
      min-width: 150px; /* è®¾ç½®æœ€å°å®½åº¦ï¼Œé˜²æ­¢è¿‡çª„ */ 
    }
    
    /* è½¦ç‰Œå·è¾“å…¥æç¤º */
    .plate-hint { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-top: 5px; 
      font-size: 12px; 
      color: var(--text-secondary); 
    }
    
    .plate-length-counter { 
      color: var(--primary); 
      font-weight: bold; 
    }
    
    .form-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
      gap: 15px; 
      margin-bottom: 20px; 
    }
    
    .form-group { 
      margin-bottom: 15px; 
    }
    
    label { 
      display: block; 
      margin-bottom: 6px; 
      font-weight: bold; 
      color: var(--text); 
      font-size: 14px; 
    }
    
    .table-container { 
      max-height: 400px; 
      overflow-y: auto; 
      border-radius: 8px; 
      border: 1px solid var(--border); 
    }
    
    table { 
      width: 100%; 
      border-collapse: collapse; 
      font-size: 14px; 
    }
    
    thead th { 
      background: var(--card-bg); 
      position: sticky; 
      top: 0; 
      z-index: 10; 
      border-bottom: 2px solid var(--border); 
      padding: 12px 15px; 
      text-align: left; 
      color: var(--text-secondary); 
      font-weight: bold; 
    }
    
    tbody td { 
      padding: 12px 15px; 
      border-bottom: 1px solid var(--border); 
      color: var(--text); 
    }
    
    tbody tr:hover { 
      background: rgba(0, 123, 255, 0.03); 
    }
    
    .action-buttons { 
      display: flex; 
      gap: 5px; 
    }
    
    .action-btn { 
      padding: 6px 10px; 
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 13px; 
      border: none; 
      transition: var(--transition); 
    }
    
    .edit-btn { 
      background: var(--primary); 
      color: white; 
    }
    
    .edit-btn:hover { 
      background: var(--primary-hover); 
    }
    
    .delete-btn { 
      background: var(--danger); 
      color: white; 
    }
    
    .delete-btn:hover { 
      background: var(--danger-hover); 
    }
    
    .empty-state { 
      text-align: center; 
      padding: 40px; 
      color: var(--text-secondary); 
      font-style: italic; 
    }
    
    .message { 
      margin-top: 15px; 
      padding: 12px; 
      border-radius: 8px; 
      text-align: center; 
      font-size: 14px; 
      display: none; 
    }
    
    .success { 
      background-color: var(--success-light); 
      color: var(--success); 
      display: block; 
    }
    
    .error { 
      background-color: rgba(220, 53, 69, 0.1); 
      color: var(--danger); 
      display: block; 
    }
    
    .info { 
      background-color: rgba(255, 193, 7, 0.1); 
      color: #856404; 
      display: block; 
    }
    
    .pagination { 
      display: flex; 
      justify-content: center; 
      margin-top: 20px; 
      gap: 8px; 
    }
    
    .pagination-btn { 
      padding: 6px 12px; 
      border: 1px solid var(--border); 
      background: var(--card-bg); 
      color: var(--text); 
      border-radius: 4px; 
      cursor: pointer; 
      transition: var(--transition); 
    }
    
    .pagination-btn:hover, .pagination-btn.active { 
      background: var(--primary); 
      color: white; 
      border-color: var(--primary); 
    }
    
    .tabs { 
      display: flex; 
      border-bottom: 1px solid var(--border); 
      margin-bottom: 20px; 
    }
    
    .tab { 
      padding: 10px 20px; 
      cursor: pointer; 
      border-bottom: 2px solid transparent; 
      transition: var(--transition); 
      display: flex; 
      align-items: center; 
      gap: 8px; 
    }
    
    .tab i { 
      font-size: 16px; 
    }
    
    .tab.active { 
      border-bottom-color: var(--primary); 
      color: var(--primary); 
      font-weight: bold; 
    }
    
    .tab-content { 
      display: none; 
    }
    
    .tab-content.active { 
      display: block; 
    }
    
    .loading { 
      display: inline-block; 
      width: 20px; 
      height: 20px; 
      border: 3px solid rgba(0, 123, 255, 0.3); 
      border-radius: 50%; 
      border-top-color: var(--primary); 
      animation: spin 1s ease-in-out infinite; 
    }
    
    @keyframes spin { 
      to { 
        transform: rotate(360deg); 
      } 
    }
    
    .loading-container { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      padding: 40px; 
    }
    
    .footer { 
      text-align: center; 
      padding: 20px; 
      color: var(--text-secondary); 
      font-size: 13px; 
      margin-top: 40px; 
    }
    
    /* åŠ è½½é®ç½© */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      display: none;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) { 
      .form-grid { 
        grid-template-columns: 1fr; 
      } 
      
      .search-input-group { 
        flex-direction: column; 
      } 
      
      .controls { 
        justify-content: center; 
        width: 100%; 
      } 
      
      .header { 
        flex-direction: column; 
        align-items: flex-start; 
      } 
      
      .welcome { 
        margin-bottom: 10px; 
      } 
      
      .tabs { 
        overflow-x: auto; 
      } 
      
      .tab { 
        white-space: nowrap; 
      } 
      
      .log-actions { 
        flex-direction: column; 
        align-items: flex-start; 
      } 
      
      .details-popup { 
        width: 250px; 
        left: 50%; 
        transform: translateX(-50%); 
      } 
      
      .checkbox-group { 
        flex-direction: column; 
        gap: 8px; 
      }
      
      .checkbox-item {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 8px;
      }
      
      .checkbox-item input[type="checkbox"] {
        width: 18px;
        height: 18px;
        margin: 0;
      }
      
      .checkbox-item > label {
        margin: 0;
        font-weight: normal;
      }
      
      .notification-config-item {
        width: 100%;
        margin-top: 8px;
      } 
      
      /* ç§»åŠ¨ç«¯è½¦ç‰Œå·è¾“å…¥æ¡†è°ƒæ•´ä¸ºå‚ç›´æ’åˆ— */
      .plate-input-container { 
        flex-direction: column; 
      } 
      
      .plate-input-container select, 
      .plate-input-container input { 
        width: 100%; /* ç§»åŠ¨ç«¯å®½åº¦100% */ 
      } 
      
      .province-select, 
      .city-letter-select, 
      .remaining-number-input { 
        width: 100%; 
        min-width: auto; 
      } 
    } 
  </style>
</head>
<body>
  <!-- ç³»ç»Ÿæ ‡é¢˜ -->
  <div class="system-title">
    <i>ğŸš—</i> è½¦ç‰Œç®¡ç†ç³»ç»Ÿ
  </div>
  
  <!-- é¡µé¢å¯¼èˆªæ ‡é¢˜ -->
  <h1 class="page-title">åŒ—æ²æŒªè½¦é€šçŸ¥ç³»ç»Ÿ</h1>
  
  <!-- åŠŸèƒ½åŒºå—æ ‡é¢˜ -->
  <div class="section-title">è½¦ç‰Œåˆ—è¡¨</div>
  
  <!-- æç¤ºæ¶ˆæ¯å®¹å™¨ -->
  <div id="toastContainer"></div>
  
  <!-- åŠ è½½é®ç½© -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>
  
  <div class="container">
    <div class="header">
      <div class="logo">ğŸš— è½¦ç‰Œç®¡ç†ç³»ç»Ÿ</div>
      <div class="controls">
        <button class="btn btn-primary" onclick="openAddPlateModal()"><i>+</i> æ·»åŠ è½¦ç‰Œ</button>
        <button class="btn btn-danger" onclick="logout()"><i>ğŸšª</i> é€€å‡º</button>
        <button class="btn btn-theme" onclick="toggleTheme()"><i>ğŸŒ“</i></button>
      </div>
    </div>
    
    <div class="tabs">
      <div class="tab active" onclick="switchTab('plate-management')">
        <i>ğŸ“‹</i> è½¦ç‰Œç®¡ç†
      </div>
      <div class="tab" onclick="switchTab('system-settings')">
        <i>âš™ï¸</i> ç³»ç»Ÿè®¾ç½®
      </div>
      <div class="tab" onclick="switchTab('operation-logs')">
        <i>ğŸ“</i> æ“ä½œæ—¥å¿—
      </div>
    </div>
    
    <!-- è½¦ç‰Œç®¡ç†æ ‡ç­¾é¡µ -->
    <div id="plate-management" class="tab-content active">
      <div class="card">
        <div class="card-header">
          <h2>è½¦ç‰Œåˆ—è¡¨</h2>
          <button class="btn btn-primary" onclick="refreshPlates()"><i>ğŸ”„</i> åˆ·æ–°</button>
        </div>
        <div class="card-body">
          <div class="search-container">
            <div class="search-input-group">
              <input type="text" id="plateSearch" placeholder="æœç´¢è½¦ç‰Œ...">
              <button class="btn btn-primary" onclick="searchPlates()"><i>ğŸ”</i> æœç´¢</button>
              <button class="btn btn-primary" onclick="resetSearch()"><i>â†º</i> é‡ç½®</button>
            </div>
          </div>
          
          <div class="table-container">
            <table id="platesTable">
              <thead>
                <tr>
                  <th>è½¦ç‰Œå·</th>
                  <th>ç”¨æˆ·UID</th>
                  <th>é€šçŸ¥æ–¹å¼</th>
                  <th>å¤‡æ³¨</th>
                  <th>æ·»åŠ æ—¶é—´</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="platesTableBody">
                <!-- è½¦ç‰Œæ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
              </tbody>
            </table>
          </div>
          
          <div class="loading-container" id="platesLoading" style="display: none;">
            <div class="loading"></div>
            <span>åŠ è½½ä¸­...</span>
          </div>
          
          <div class="empty-state" id="platesEmptyState" style="display: none;">
            æš‚æ— è½¦ç‰Œæ•°æ®ï¼Œè¯·æ·»åŠ è½¦ç‰Œ
          </div>
          
          <div class="pagination" id="platesPagination">
            <!-- åˆ†é¡µæŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- ç³»ç»Ÿè®¾ç½®æ ‡ç­¾é¡µ -->
    <div id="system-settings" class="tab-content">
      <div class="card">
        <div class="card-header">
          <h2>ç³»ç»Ÿè®¾ç½®</h2>
        </div>
        <div class="card-body">
          <div class="form-grid">
            <div class="form-group">
              <label for="adminPassword">ç®¡ç†å‘˜å¯†ç ä¿®æ”¹</label>
              <input type="password" id="adminPassword" placeholder="è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰">
              <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">ç•™ç©ºåˆ™ä¸ä¿®æ”¹å¯†ç </div>
            </div>
          </div>
          
          <div class="message" id="settingsMessage"></div>
          <button class="btn btn-primary" onclick="saveSystemSettings()"><i>ğŸ’¾</i> ä¿å­˜è®¾ç½®</button>
        </div>
      </div>
    </div>
    
    <!-- æ“ä½œæ—¥å¿—æ ‡ç­¾é¡µ -->
    <div id="operation-logs" class="tab-content">
      <div class="card">
        <div class="card-header">
          <h2>æ“ä½œæ—¥å¿—</h2>
        </div>
        
        <div class="card-body">
          <div class="search-container">
            <div class="search-input-group">
              <input type="text" id="logSearch" placeholder="æœç´¢æ“ä½œ...">
              <button class="btn btn-primary" onclick="searchLogs()"><i>ğŸ”</i> æœç´¢</button>
            </div>
          </div>
          
          <!-- æ—¥å¿—æ“ä½œæŒ‰é’® -->
          <div class="log-actions">
            <label>
              <input type="checkbox" id="selectAllLogs"> å…¨é€‰
            </label>
            <button class="btn btn-danger" onclick="deleteSelectedLogs()"><span style="margin-right: 5px;">ğŸ—‘ï¸</span> åˆ é™¤é€‰ä¸­æ—¥å¿—</button>
            <div class="message" id="logMessage"></div>
          </div>
          
          <div class="table-container">
            <table id="logsTable">
              <thead>
                <tr>
                  <th><input type="checkbox" id="headerLogCheckbox"></th>
                  <th>æ“ä½œ</th>                  
                  <th>æ—¶é—´</th>
                  <th>IPåœ°å€</th>
                  <th>è¯¦æƒ…</th>
                </tr>
              </thead>
              <tbody id="logsTableBody">
                <!-- æ—¥å¿—æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
              </tbody>
            </table>
          </div>
          
          <div class="loading-container" id="logsLoading" style="display: none;">
            <div class="loading"></div>
            <span>åŠ è½½ä¸­...</span>
          </div>
          
          <div class="empty-state" id="logsEmptyState" style="display: none;">
            æš‚æ— æ—¥å¿—æ•°æ®
          </div>
          
          <div class="pagination" id="logsPagination">
            <!-- åˆ†é¡µæŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
          </div>          
        </div>
      </div>
    </div>
  </div>
  
  <!-- æ·»åŠ /ç¼–è¾‘è½¦ç‰Œæ¨¡æ€æ¡† -->
  <div id="plateModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div class="card" style="max-width: 500px; width: 100%;">
      <div class="card-header">
        <h2 id="plateModalTitle">æ·»åŠ è½¦ç‰Œ</h2>
        <button class="btn btn-danger" style="padding: 6px 10px; font-size: 14px;" onclick="closePlateModal()"><i>âœ•</i></button>
      </div>
      <div class="card-body">
        <input type="hidden" id="editPlateId">
        <div class="form-group">
          <label for="modalPlateNumber">è½¦ç‰Œå·</label>
          <div class="plate-input-container">
            <select id="provinceSelect" class="province-select" placeholder="çœä»½">
              <option value="">è¯·é€‰æ‹©çœä»½</option>
              <!-- çœä»½é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </select>
            <select id="cityLetterSelect" class="city-letter-select" placeholder="å­—æ¯/åŸå¸‚">
              <option value="">è¯·é€‰æ‹©å­—æ¯/åŸå¸‚</option>
              <!-- åŸå¸‚å­—æ¯é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </select>
            <input type="text" id="remainingNumber" class="remaining-number-input" placeholder="å5-6ä½">
          </div>
          <div class="plate-hint">
            <span>
              æ™®é€šè½¦ç‰Œ5ä½ï¼ˆå¦‚ï¼š12345ï¼‰ï¼Œæ–°èƒ½æºè½¦ç‰Œ6ä½ï¼ˆå¦‚ï¼š123456ï¼‰<br>
              å‰ä¸¤ä½é€šè¿‡ä¸‹æ‹‰æ¡†é€‰æ‹©ï¼Œå5-6ä½æ‰‹åŠ¨è¾“å…¥
            </span>
            <span class="plate-length-counter" id="plateLengthCounter">0/6</span>
          </div>
        </div>
        <div class="form-group">
          <label>é€šçŸ¥æ¸ é“é…ç½®</label>
          <div class="checkbox-group" id="notificationChannels">
            <div class="checkbox-item">
              <input type="checkbox" id="channelWxpusher" value="wxpusher">
              <label for="channelWxpusher">WxPusher</label>
              <div id="wxpusherConfig" class="notification-config-item" style="display: none;">
                <input type="text" id="wxpusherToken" placeholder="è¾“å…¥WxPusher APP Token" style="margin-bottom: 8px;">
                <input type="text" id="modalPlateUid" placeholder="è¾“å…¥ç”¨æˆ·UIDï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰">
              </div>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="channelWechatWork" value="wechat_work">
              <label for="channelWechatWork">ä¼ä¸šå¾®ä¿¡</label>
              <div id="wechatWorkConfig" class="notification-config-item" style="display: none;">
                <input type="text" id="wechatWorkWebhook" placeholder="è¾“å…¥ä¼ä¸šå¾®ä¿¡æœºå™¨äººWebhookåœ°å€">
              </div>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="channelDingtalk" value="dingtalk">
              <label for="channelDingtalk">é’‰é’‰</label>
              <div id="dingtalkConfig" class="notification-config-item" style="display: none;">
                <input type="text" id="dingtalkWebhook" placeholder="è¾“å…¥é’‰é’‰æœºå™¨äººWebhookåœ°å€">
              </div>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="channelBark" value="bark">
              <label for="channelBark">Bark</label>
              <div id="barkConfig" class="notification-config-item" style="display: none;">
                <input type="text" id="barkWebhook" placeholder="è¾“å…¥BarkæœåŠ¡å™¨åœ°å€">
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="modalPlateRemark">å¤‡æ³¨</label>
          <input type="text" id="modalPlateRemark" placeholder="è¾“å…¥å¤‡æ³¨ä¿¡æ¯">
        </div>
        <div class="message" id="modalMessage"></div>
        <button class="btn btn-primary" id="savePlateBtn" onclick="savePlate()"><i>ğŸ’¾</i> ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- äºŒç»´ç å¼¹çª— -->
  <div id="qrcodeModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div class="card" style="max-width: 400px; width: 100%; text-align: center;">
      <div class="card-header">
        <h2>æ‰«ç æŒªè½¦</h2>
        <button class="btn btn-danger" style="padding: 6px 10px; font-size: 14px;" onclick="closeQRCodeModal()"><i>âœ•</i></button>
      </div>
      <div class="card-body">
        <p style="margin-bottom: 15px; color: var(--text-secondary);">è½¦ç‰Œå·: <strong id="qrcodePlate" style="color: var(--primary); font-size: 18px;"></strong></p>
        <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 15px;">å¤åˆ¶é“¾æ¥ç”ŸæˆäºŒç»´ç ï¼Œæ‰«ç åè¾“å…¥æ‰‹æœºå·å³å¯é€šçŸ¥è½¦ä¸»æŒªè½¦</p>
        <input type="text" id="qrcodeLink" readonly style="width: 100%; margin-bottom: 15px; background: var(--bg); cursor: pointer;" onclick="this.select()">
        <button class="btn btn-primary" onclick="copyQRCodeLink()" style="background: #17a2b8;"><i>ğŸ“‹</i> å¤åˆ¶é“¾æ¥</button>
      </div>
    </div>
  </div>

  <script>
    // å…¨å±€å˜é‡
    let currentPlatesPage = 1;
    let currentLogsPage = 1; 
    let currentSearchTerm = '';
    let isLoading = false;
    
    // è½¦ç‰Œå·éªŒè¯æ­£åˆ™è¡¨è¾¾å¼
    const plateRegex = /^[\u4e00-\u9fa5][A-Z][A-HJ-NP-Z0-9]{5,6}$/;
    
    // 2025å¹´æœ€æ–°å…¨å›½çœä»½å’ŒåŸå¸‚æ•°æ®
    const provinceCityData = {
      "äº¬": [{"letter":"A","city":"ä¸œåŸ/è¥¿åŸ"},{"letter":"C","city":"æœé˜³åŒº"},{"letter":"E","city":"æµ·æ·€åŒº"},{"letter":"F","city":"ä¸°å°åŒº"},{"letter":"H","city":"çŸ³æ™¯å±±åŒº"},{"letter":"J","city":"æˆ¿å±±åŒº"},{"letter":"K","city":"é€šå·åŒº"},{"letter":"L","city":"é¡ºä¹‰åŒº"},{"letter":"M","city":"æ˜Œå¹³åŒº"},{"letter":"N","city":"å¤§å…´åŒº"},{"letter":"P","city":"æ€€æŸ”åŒº"},{"letter":"Q","city":"å¹³è°·åŒº"},{"letter":"Y","city":"å»¶åº†åŒº"},{"letter":"G","city":"å¯†äº‘åŒº"}],
      "æ´¥": [{"letter":"A","city":"å’Œå¹³/æ²³ä¸œ/æ²³è¥¿"},{"letter":"B","city":"å—å¼€/æ²³åŒ—/çº¢æ¡¥"},{"letter":"C","city":"ä¸œä¸½/è¥¿é’/æ´¥å—"},{"letter":"D","city":"åŒ—è¾°/æ­¦æ¸…"},{"letter":"F","city":"å®å»åŒº"},{"letter":"G","city":"æ»¨æµ·æ–°åŒº"},{"letter":"H","city":"å®æ²³åŒº"},{"letter":"J","city":"é™æµ·åŒº"},{"letter":"K","city":"è“Ÿå·åŒº"}],
      "æ²ª": [{"letter":"A","city":"é»„æµ¦/å¾æ±‡/é•¿å®"},{"letter":"B","city":"é™å®‰/æ™®é™€"},{"letter":"D","city":"è™¹å£/æ¨æµ¦"},{"letter":"E","city":"é—µè¡Œ/å®å±±"},{"letter":"F","city":"å˜‰å®š/æµ¦ä¸œ"},{"letter":"G","city":"é‡‘å±±/æ¾æ±Ÿ"},{"letter":"H","city":"é’æµ¦"},{"letter":"J","city":"å¥‰è´¤"},{"letter":"K","city":"å´‡æ˜"}],
      "æ¸": [{"letter":"A","city":"æ¸ä¸­/æ±ŸåŒ—/æ²™åªå"},{"letter":"B","city":"å—å²¸/ä¹é¾™å¡/å¤§æ¸¡å£"},{"letter":"C","city":"æ°¸å·/æ±Ÿæ´¥/åˆå·"},{"letter":"F","city":"ä¸‡å·/æ¢å¹³/åŸå£"},{"letter":"G","city":"æ¶ªé™µ/å«æ±Ÿ/ä¸°éƒ½"},{"letter":"H","city":"é»”æ±Ÿ/é…‰é˜³/ç§€å±±"},{"letter":"J","city":"çŸ³æŸ±/å½­æ°´/æ­¦éš†"}],
      "ç¼": [{"letter":"A","city":"æµ·å£å¸‚"},{"letter":"B","city":"ä¸‰äºšå¸‚"},{"letter":"C","city":"ç¼æµ·å¸‚/æ–‡æ˜Œå¸‚/ä¸‡å®å¸‚"},{"letter":"D","city":"äº”æŒ‡å±±å¸‚/ä¸œæ–¹å¸‚"},{"letter":"E","city":"æ´‹æµ¦ç»æµå¼€å‘åŒº"},{"letter":"F","city":"å„‹å·å¸‚"}],
      "å†€": [{"letter":"A","city":"çŸ³å®¶åº„å¸‚"},{"letter":"B","city":"å”å±±å¸‚"},{"letter":"C","city":"ç§¦çš‡å²›å¸‚"},{"letter":"D","city":"é‚¯éƒ¸å¸‚"},{"letter":"E","city":"é‚¢å°å¸‚"},{"letter":"F","city":"ä¿å®šå¸‚"},{"letter":"G","city":"å¼ å®¶å£å¸‚"},{"letter":"H","city":"æ‰¿å¾·å¸‚"},{"letter":"J","city":"æ²§å·å¸‚"},{"letter":"R","city":"å»ŠåŠå¸‚"},{"letter":"T","city":"è¡¡æ°´å¸‚"}],
      "æ™‹": [{"letter":"A","city":"å¤ªåŸå¸‚"},{"letter":"B","city":"å¤§åŒå¸‚"},{"letter":"C","city":"é˜³æ³‰å¸‚"},{"letter":"D","city":"é•¿æ²»å¸‚"},{"letter":"E","city":"æ™‹åŸå¸‚"},{"letter":"F","city":"æœ”å·å¸‚"},{"letter":"H","city":"å¿»å·å¸‚"},{"letter":"J","city":"å•æ¢å¸‚"},{"letter":"K","city":"æ™‹ä¸­å¸‚"},{"letter":"L","city":"ä¸´æ±¾å¸‚"},{"letter":"M","city":"è¿åŸå¸‚"}],
      "è’™": [{"letter":"A","city":"å‘¼å’Œæµ©ç‰¹å¸‚"},{"letter":"B","city":"åŒ…å¤´å¸‚"},{"letter":"C","city":"ä¹Œæµ·å¸‚"},{"letter":"D","city":"èµ¤å³°å¸‚"},{"letter":"E","city":"å‘¼ä¼¦è´å°”å¸‚"},{"letter":"F","city":"å…´å®‰ç›Ÿ"},{"letter":"G","city":"é€šè¾½å¸‚"},{"letter":"H","city":"é”¡æ—éƒ­å‹’ç›Ÿ"},{"letter":"J","city":"ä¹Œå…°å¯Ÿå¸ƒå¸‚"},{"letter":"K","city":"é„‚å°”å¤šæ–¯å¸‚"},{"letter":"L","city":"å·´å½¦æ·–å°”å¸‚"},{"letter":"M","city":"é˜¿æ‹‰å–„ç›Ÿ"}],
      "è¾½": [{"letter":"A","city":"æ²ˆé˜³å¸‚"},{"letter":"B","city":"å¤§è¿å¸‚"},{"letter":"C","city":"éå±±å¸‚"},{"letter":"D","city":"æŠšé¡ºå¸‚"},{"letter":"E","city":"æœ¬æºªå¸‚"},{"letter":"F","city":"ä¸¹ä¸œå¸‚"},{"letter":"G","city":"é”¦å·å¸‚"},{"letter":"H","city":"è¥å£å¸‚"},{"letter":"J","city":"é˜œæ–°å¸‚"},{"letter":"K","city":"è¾½é˜³å¸‚"},{"letter":"L","city":"ç›˜é”¦å¸‚"},{"letter":"M","city":"é“å²­å¸‚"},{"letter":"N","city":"æœé˜³å¸‚"},{"letter":"P","city":"è‘«èŠ¦å²›å¸‚"}],
      "å‰": [{"letter":"A","city":"é•¿æ˜¥å¸‚"},{"letter":"B","city":"å‰æ—å¸‚"},{"letter":"C","city":"å››å¹³å¸‚"},{"letter":"D","city":"è¾½æºå¸‚"},{"letter":"E","city":"é€šåŒ–å¸‚"},{"letter":"F","city":"ç™½å±±å¸‚"},{"letter":"G","city":"ç™½åŸå¸‚"},{"letter":"H","city":"å»¶è¾¹æœé²œæ—è‡ªæ²»å·"},{"letter":"J","city":"æ¾åŸå¸‚"}],
      "é»‘": [{"letter":"A","city":"å“ˆå°”æ»¨å¸‚"},{"letter":"B","city":"é½é½å“ˆå°”å¸‚"},{"letter":"C","city":"ç‰¡ä¸¹æ±Ÿå¸‚"},{"letter":"D","city":"ä½³æœ¨æ–¯å¸‚"},{"letter":"E","city":"å¤§åº†å¸‚"},{"letter":"F","city":"ä¼Šæ˜¥å¸‚"},{"letter":"G","city":"é¸¡è¥¿å¸‚"},{"letter":"H","city":"é¹¤å²—å¸‚"},{"letter":"J","city":"åŒé¸­å±±å¸‚"},{"letter":"K","city":"ä¸ƒå°æ²³å¸‚"},{"letter":"L","city":"æ¾èŠ±æ±Ÿåœ°åŒº"},{"letter":"M","city":"ç»¥åŒ–å¸‚"},{"letter":"N","city":"é»‘æ²³å¸‚"},{"letter":"P","city":"å¤§å…´å®‰å²­åœ°åŒº"}],
      "è‹": [{"letter":"A","city":"å—äº¬å¸‚"},{"letter":"B","city":"æ— é”¡å¸‚"},{"letter":"C","city":"å¾å·å¸‚"},{"letter":"D","city":"å¸¸å·å¸‚"},{"letter":"E","city":"è‹å·å¸‚"},{"letter":"F","city":"å—é€šå¸‚"},{"letter":"G","city":"è¿äº‘æ¸¯å¸‚"},{"letter":"H","city":"æ·®å®‰å¸‚"},{"letter":"J","city":"ç›åŸå¸‚"},{"letter":"K","city":"æ‰¬å·å¸‚"},{"letter":"L","city":"é•‡æ±Ÿå¸‚"},{"letter":"M","city":"æ³°å·å¸‚"},{"letter":"N","city":"å®¿è¿å¸‚"}],
      "æµ™": [{"letter":"A","city":"æ­å·å¸‚"},{"letter":"B","city":"å®æ³¢å¸‚"},{"letter":"C","city":"æ¸©å·å¸‚"},{"letter":"D","city":"ç»å…´å¸‚"},{"letter":"E","city":"æ¹–å·å¸‚"},{"letter":"F","city":"å˜‰å…´å¸‚"},{"letter":"G","city":"é‡‘åå¸‚"},{"letter":"H","city":"è¡¢å·å¸‚"},{"letter":"J","city":"å°å·å¸‚"},{"letter":"K","city":"ä¸½æ°´å¸‚"},{"letter":"L","city":"èˆŸå±±å¸‚"}],
      "çš–": [{"letter":"A","city":"åˆè‚¥å¸‚"},{"letter":"B","city":"èŠœæ¹–å¸‚"},{"letter":"C","city":"èšŒåŸ å¸‚"},{"letter":"D","city":"æ·®å—å¸‚"},{"letter":"E","city":"é©¬éå±±å¸‚"},{"letter":"F","city":"æ·®åŒ—å¸‚"},{"letter":"G","city":"é“œé™µå¸‚"},{"letter":"H","city":"å®‰åº†å¸‚"},{"letter":"J","city":"é»„å±±å¸‚"},{"letter":"K","city":"é˜œé˜³å¸‚"},{"letter":"L","city":"å®¿å·å¸‚"},{"letter":"M","city":"æ»å·å¸‚"},{"letter":"N","city":"å…­å®‰å¸‚"},{"letter":"P","city":"å®£åŸå¸‚"},{"letter":"Q","city":"å·¢æ¹–å¸‚"},{"letter":"R","city":"æ± å·å¸‚"},{"letter":"S","city":"äº³å·å¸‚"}],
      "é—½": [{"letter":"A","city":"ç¦å·å¸‚"},{"letter":"B","city":"è†ç”°å¸‚"},{"letter":"C","city":"æ³‰å·å¸‚"},{"letter":"D","city":"å¦é—¨å¸‚"},{"letter":"E","city":"æ¼³å·å¸‚"},{"letter":"F","city":"é¾™å²©å¸‚"},{"letter":"G","city":"ä¸‰æ˜å¸‚"},{"letter":"H","city":"å—å¹³å¸‚"},{"letter":"J","city":"å®å¾·å¸‚"},{"letter":"K","city":"å¹³æ½­ç»¼åˆå®éªŒåŒº"}],
      "èµ£": [{"letter":"A","city":"å—æ˜Œå¸‚"},{"letter":"B","city":"èµ£å·å¸‚"},{"letter":"C","city":"å®œæ˜¥å¸‚"},{"letter":"D","city":"å‰å®‰å¸‚"},{"letter":"E","city":"ä¸Šé¥¶å¸‚"},{"letter":"F","city":"æŠšå·å¸‚"},{"letter":"G","city":"ä¹æ±Ÿå¸‚"},{"letter":"H","city":"æ™¯å¾·é•‡å¸‚"},{"letter":"J","city":"èä¹¡å¸‚"},{"letter":"K","city":"æ–°ä½™å¸‚"},{"letter":"L","city":"é¹°æ½­å¸‚"}],
      "é²": [{"letter":"A","city":"æµå—å¸‚"},{"letter":"B","city":"é’å²›å¸‚"},{"letter":"C","city":"æ·„åšå¸‚"},{"letter":"D","city":"æ£åº„å¸‚"},{"letter":"E","city":"ä¸œè¥å¸‚"},{"letter":"F","city":"çƒŸå°å¸‚"},{"letter":"G","city":"æ½åŠå¸‚"},{"letter":"H","city":"æµå®å¸‚"},{"letter":"J","city":"æ³°å®‰å¸‚"},{"letter":"K","city":"å¨æµ·å¸‚"},{"letter":"L","city":"æ—¥ç…§å¸‚"},{"letter":"M","city":"æ»¨å·å¸‚"},{"letter":"N","city":"å¾·å·å¸‚"},{"letter":"P","city":"èŠåŸå¸‚"},{"letter":"Q","city":"ä¸´æ²‚å¸‚"},{"letter":"R","city":"èæ³½å¸‚"}],
      "è±«": [{"letter":"A","city":"éƒ‘å·å¸‚"},{"letter":"B","city":"å¼€å°å¸‚"},{"letter":"C","city":"æ´›é˜³å¸‚"},{"letter":"D","city":"å¹³é¡¶å±±å¸‚"},{"letter":"E","city":"å®‰é˜³å¸‚"},{"letter":"F","city":"é¹¤å£å¸‚"},{"letter":"G","city":"æ–°ä¹¡å¸‚"},{"letter":"H","city":"ç„¦ä½œå¸‚"},{"letter":"J","city":"æ¿®é˜³å¸‚"},{"letter":"K","city":"è®¸æ˜Œå¸‚"},{"letter":"L","city":"æ¼¯æ²³å¸‚"},{"letter":"M","city":"ä¸‰é—¨å³¡å¸‚"},{"letter":"N","city":"å•†ä¸˜å¸‚"},{"letter":"P","city":"å‘¨å£å¸‚"},{"letter":"Q","city":"é©»é©¬åº—å¸‚"},{"letter":"R","city":"å—é˜³å¸‚"},{"letter":"S","city":"ä¿¡é˜³å¸‚"},{"letter":"U","city":"æµæºå¸‚"}],
      "é„‚": [{"letter":"A","city":"æ­¦æ±‰å¸‚"},{"letter":"B","city":"é»„çŸ³å¸‚"},{"letter":"C","city":"åå °å¸‚"},{"letter":"D","city":"è†å·å¸‚"},{"letter":"E","city":"å®œæ˜Œå¸‚"},{"letter":"F","city":"è¥„é˜³å¸‚"},{"letter":"G","city":"é„‚å·å¸‚"},{"letter":"H","city":"è†é—¨å¸‚"},{"letter":"J","city":"é»„å†ˆå¸‚"},{"letter":"K","city":"å­æ„Ÿå¸‚"},{"letter":"L","city":"å’¸å®å¸‚"},{"letter":"M","city":"ä»™æ¡ƒå¸‚"},{"letter":"N","city":"æ½œæ±Ÿå¸‚"},{"letter":"P","city":"ç¥å†œæ¶æ—åŒº"},{"letter":"Q","city":"æ©æ–½åœŸå®¶æ—è‹—æ—è‡ªæ²»å·"},{"letter":"R","city":"å¤©é—¨å¸‚"},{"letter":"S","city":"éšå·å¸‚"}],
      "æ¹˜": [{"letter":"A","city":"é•¿æ²™å¸‚"},{"letter":"B","city":"æ ªæ´²å¸‚"},{"letter":"C","city":"æ¹˜æ½­å¸‚"},{"letter":"D","city":"è¡¡é˜³å¸‚"},{"letter":"E","city":"é‚µé˜³å¸‚"},{"letter":"F","city":"å²³é˜³å¸‚"},{"letter":"G","city":"å¼ å®¶ç•Œå¸‚"},{"letter":"H","city":"ç›Šé˜³å¸‚"},{"letter":"J","city":"å¸¸å¾·å¸‚"},{"letter":"K","city":"å¨„åº•å¸‚"},{"letter":"L","city":"éƒ´å·å¸‚"},{"letter":"M","city":"æ°¸å·å¸‚"},{"letter":"N","city":"æ€€åŒ–å¸‚"},{"letter":"U","city":"æ¹˜è¥¿åœŸå®¶æ—è‹—æ—è‡ªæ²»å·"}],
      "ç²¤": [{"letter":"A","city":"å¹¿å·å¸‚"},{"letter":"B","city":"æ·±åœ³å¸‚"},{"letter":"C","city":"ç æµ·å¸‚"},{"letter":"D","city":"æ±•å¤´å¸‚"},{"letter":"E","city":"ä½›å±±å¸‚"},{"letter":"F","city":"éŸ¶å…³å¸‚"},{"letter":"G","city":"æ¹›æ±Ÿå¸‚"},{"letter":"H","city":"è‚‡åº†å¸‚"},{"letter":"J","city":"æ±Ÿé—¨å¸‚"},{"letter":"K","city":"èŒ‚åå¸‚"},{"letter":"L","city":"æƒ å·å¸‚"},{"letter":"M","city":"æ¢…å·å¸‚"},{"letter":"N","city":"æ±•å°¾å¸‚"},{"letter":"P","city":"æ²³æºå¸‚"},{"letter":"Q","city":"é˜³æ±Ÿå¸‚"},{"letter":"R","city":"æ¸…è¿œå¸‚"},{"letter":"S","city":"ä¸œèå¸‚"},{"letter":"T","city":"ä¸­å±±å¸‚"},{"letter":"U","city":"æ½®å·å¸‚"},{"letter":"V","city":"æ­é˜³å¸‚"},{"letter":"W","city":"äº‘æµ®å¸‚"}],
      "æ¡‚": [{"letter":"A","city":"å—å®å¸‚"},{"letter":"B","city":"æŸ³å·å¸‚"},{"letter":"C","city":"æ¡‚æ—å¸‚"},{"letter":"D","city":"æ¢§å·å¸‚"},{"letter":"E","city":"åŒ—æµ·å¸‚"},{"letter":"F","city":"å´‡å·¦å¸‚"},{"letter":"G","city":"æ¥å®¾å¸‚"},{"letter":"H","city":"æ¡‚æ—åœ°åŒº"},{"letter":"J","city":"è´ºå·å¸‚"},{"letter":"K","city":"ç‰æ—å¸‚"},{"letter":"L","city":"ç™¾è‰²å¸‚"},{"letter":"M","city":"æ²³æ± å¸‚"},{"letter":"N","city":"é’¦å·å¸‚"},{"letter":"P","city":"é˜²åŸæ¸¯å¸‚"}],
      "å·": [{"letter":"A","city":"æˆéƒ½å¸‚"},{"letter":"B","city":"ç»µé˜³å¸‚"},{"letter":"C","city":"è‡ªè´¡å¸‚"},{"letter":"D","city":"æ”€æèŠ±å¸‚"},{"letter":"E","city":"æ³¸å·å¸‚"},{"letter":"F","city":"å¾·é˜³å¸‚"},{"letter":"H","city":"å¹¿å…ƒå¸‚"},{"letter":"J","city":"é‚å®å¸‚"},{"letter":"K","city":"å†…æ±Ÿå¸‚"},{"letter":"L","city":"ä¹å±±å¸‚"},{"letter":"M","city":"èµ„é˜³å¸‚"},{"letter":"Q","city":"å®œå®¾å¸‚"},{"letter":"R","city":"å—å……å¸‚"},{"letter":"S","city":"è¾¾å·å¸‚"},{"letter":"T","city":"é›…å®‰å¸‚"},{"letter":"U","city":"é˜¿åè—æ—ç¾Œæ—è‡ªæ²»å·"},{"letter":"V","city":"ç”˜å­œè—æ—è‡ªæ²»å·"},{"letter":"W","city":"å‡‰å±±å½æ—è‡ªæ²»å·"},{"letter":"X","city":"å¹¿å®‰å¸‚"},{"letter":"Y","city":"å·´ä¸­å¸‚"},{"letter":"Z","city":"çœ‰å±±å¸‚"}],
      "è´µ": [{"letter":"A","city":"è´µé˜³å¸‚"},{"letter":"B","city":"å…­ç›˜æ°´å¸‚"},{"letter":"C","city":"éµä¹‰å¸‚"},{"letter":"D","city":"é“œä»å¸‚"},{"letter":"E","city":"é»”è¥¿å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·"},{"letter":"F","city":"æ¯•èŠ‚å¸‚"},{"letter":"G","city":"å®‰é¡ºå¸‚"},{"letter":"H","city":"é»”ä¸œå—è‹—æ—ä¾—æ—è‡ªæ²»å·"},{"letter":"J","city":"é»”å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·"}],
      "äº‘": [{"letter":"A","city":"æ˜†æ˜å¸‚"},{"letter":"C","city":"æ˜­é€šå¸‚"},{"letter":"D","city":"æ›²é–å¸‚"},{"letter":"E","city":"æ¥šé›„å½æ—è‡ªæ²»å·"},{"letter":"F","city":"ç‰æºªå¸‚"},{"letter":"G","city":"çº¢æ²³å“ˆå°¼æ—å½æ—è‡ªæ²»å·"},{"letter":"H","city":"æ–‡å±±å£®æ—è‹—æ—è‡ªæ²»å·"},{"letter":"J","city":"æ™®æ´±å¸‚"},{"letter":"K","city":"è¥¿åŒç‰ˆçº³å‚£æ—è‡ªæ²»å·"},{"letter":"L","city":"å¤§ç†ç™½æ—è‡ªæ²»å·"},{"letter":"M","city":"ä¿å±±å¸‚"},{"letter":"N","city":"å¾·å®å‚£æ—æ™¯é¢‡æ—è‡ªæ²»å·"},{"letter":"P","city":"ä¸½æ±Ÿå¸‚"},{"letter":"Q","city":"æ€’æ±Ÿå‚ˆåƒ³æ—è‡ªæ²»å·"},{"letter":"R","city":"è¿ªåº†è—æ—è‡ªæ²»å·"},{"letter":"S","city":"ä¸´æ²§å¸‚"}],
      "è—": [{"letter":"A","city":"æ‹‰è¨å¸‚"},{"letter":"B","city":"æ˜Œéƒ½å¸‚"},{"letter":"C","city":"å±±å—å¸‚"},{"letter":"D","city":"æ—¥å–€åˆ™å¸‚"},{"letter":"E","city":"é‚£æ›²å¸‚"},{"letter":"F","city":"é˜¿é‡Œåœ°åŒº"},{"letter":"G","city":"æ—èŠå¸‚"}],
      "é™•": [{"letter":"A","city":"è¥¿å®‰å¸‚"},{"letter":"B","city":"é“œå·å¸‚"},{"letter":"C","city":"å®é¸¡å¸‚"},{"letter":"D","city":"å’¸é˜³å¸‚"},{"letter":"E","city":"æ¸­å—å¸‚"},{"letter":"F","city":"æ±‰ä¸­å¸‚"},{"letter":"G","city":"å®‰åº·å¸‚"},{"letter":"H","city":"å•†æ´›å¸‚"},{"letter":"J","city":"å»¶å®‰å¸‚"},{"letter":"K","city":"æ¦†æ—å¸‚"}],
      "ç”˜": [{"letter":"A","city":"å…°å·å¸‚"},{"letter":"B","city":"å˜‰å³ªå…³å¸‚"},{"letter":"C","city":"é‡‘æ˜Œå¸‚"},{"letter":"D","city":"ç™½é“¶å¸‚"},{"letter":"E","city":"å¤©æ°´å¸‚"},{"letter":"F","city":"é…’æ³‰å¸‚"},{"letter":"G","city":"å¼ æ–å¸‚"},{"letter":"H","city":"æ­¦å¨å¸‚"},{"letter":"J","city":"å®šè¥¿å¸‚"},{"letter":"K","city":"é™‡å—å¸‚"},{"letter":"L","city":"å¹³å‡‰å¸‚"},{"letter":"M","city":"åº†é˜³å¸‚"},{"letter":"N","city":"ä¸´å¤å›æ—è‡ªæ²»å·"},{"letter":"P","city":"ç”˜å—è—æ—è‡ªæ²»å·"}],
      "é’": [{"letter":"A","city":"è¥¿å®å¸‚"},{"letter":"B","city":"æµ·ä¸œå¸‚"},{"letter":"C","city":"æµ·åŒ—è—æ—è‡ªæ²»å·"},{"letter":"D","city":"é»„å—è—æ—è‡ªæ²»å·"},{"letter":"E","city":"æµ·å—è—æ—è‡ªæ²»å·"},{"letter":"F","city":"æœæ´›è—æ—è‡ªæ²»å·"},{"letter":"G","city":"ç‰æ ‘è—æ—è‡ªæ²»å·"},{"letter":"H","city":"æµ·è¥¿è’™å¤æ—è—æ—è‡ªæ²»å·"}],
      "å®": [{"letter":"A","city":"é“¶å·å¸‚"},{"letter":"B","city":"çŸ³å˜´å±±å¸‚"},{"letter":"C","city":"å´å¿ å¸‚"},{"letter":"D","city":"å›ºåŸå¸‚"}],
      "æ–°": [{"letter":"A","city":"ä¹Œé²æœ¨é½å¸‚"},{"letter":"B","city":"æ˜Œå‰å›æ—è‡ªæ²»å·"},{"letter":"C","city":"çŸ³æ²³å­å¸‚"},{"letter":"D","city":"å¥å±¯å¸‚"},{"letter":"E","city":"åšå°”å¡”æ‹‰è’™å¤è‡ªæ²»å·"},{"letter":"F","city":"ä¼ŠçŠå“ˆè¨å…‹è‡ªæ²»å·"},{"letter":"G","city":"å¡”åŸåœ°åŒº"},{"letter":"H","city":"é˜¿å‹’æ³°åœ°åŒº"},{"letter":"J","city":"å…‹æ‹‰ç›ä¾å¸‚"},{"letter":"K","city":"åé²ç•ªå¸‚"},{"letter":"L","city":"å“ˆå¯†å¸‚"},{"letter":"M","city":"å·´éŸ³éƒ­æ¥è’™å¤è‡ªæ²»å·"},{"letter":"N","city":"é˜¿å…‹è‹åœ°åŒº"},{"letter":"P","city":"å…‹å­œå‹’è‹æŸ¯å°”å…‹å­œè‡ªæ²»å·"},{"letter":"Q","city":"å–€ä»€åœ°åŒº"},{"letter":"R","city":"å’Œç”°åœ°åŒº"}]
    };
    
    // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
    function showToast(message, type = 'info', duration = 3000) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      container.appendChild(toast);
      
      // æ˜¾ç¤ºå¹¶è‡ªåŠ¨å…³é—­
      setTimeout(() => {
        toast.style.display = 'block';
        setTimeout(() => {
          toast.style.opacity = '0';
          setTimeout(() => {
            container.removeChild(toast);
          }, 300); // ç­‰å¾…æ·¡å‡ºåŠ¨ç”»å®Œæˆ
        }, 100);
      }, 100);
    }
    
    // æ˜¾ç¤ºåŠ è½½é®ç½©
    function showLoading() {
      isLoading = true;
      document.getElementById('loadingOverlay').style.display = 'flex';
    }
    
    // éšè—åŠ è½½é®ç½©
    function hideLoading() {
      isLoading = false;
      document.getElementById('loadingOverlay').style.display = 'none';
    }
    
    // æ›´æ–°è½¦ç‰Œå·é•¿åº¦è®¡æ•°å™¨
    function updatePlateLengthCounter() {
      const input = document.getElementById('remainingNumber');
      const counter = document.getElementById('plateLengthCounter');
      const currentLength = input.value.length;
      const maxLength = 6; // æ–°èƒ½æºè½¦ç‰Œæœ€é•¿6ä½
      
      counter.textContent = `${currentLength}/${maxLength}`;
      
      // æ ¹æ®é•¿åº¦æ”¹å˜é¢œè‰²æç¤º
      if (currentLength === 5 || currentLength === 6) {
        counter.style.color = 'var(--success)';
      } else if (currentLength > 6) {
        counter.style.color = 'var(--danger)';
      } else {
        counter.style.color = 'var(--primary)';
      }
    }
    
    // åˆå§‹åŒ–çœä»½ä¸‹æ‹‰æ¡†
    function initProvinceDropdown() {
      try {
        const provinceSelect = document.getElementById('provinceSelect');
        if (!provinceSelect) {
          console.error('æœªæ‰¾åˆ°çœä»½é€‰æ‹©ä¸‹æ‹‰æ¡†');
          showToast('çœä»½æ•°æ®åŠ è½½å¤±è´¥', 'error');
          return;
        }
        
        // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ª"è¯·é€‰æ‹©çœä»½"é€‰é¡¹ï¼‰
        while (provinceSelect.options.length > 1) {
          provinceSelect.remove(1);
        }
        
        // æ·»åŠ çœä»½é€‰é¡¹
        for (const [abbr, cities] of Object.entries(provinceCityData)) {
          // æ ¹æ®çœä»½ç®€ç§°è·å–çœä»½åç§°
          let provinceName = '';
          switch(abbr) {
            case 'äº¬': provinceName = 'åŒ—äº¬å¸‚'; break;
            case 'æ´¥': provinceName = 'å¤©æ´¥å¸‚'; break;
            case 'æ²ª': provinceName = 'ä¸Šæµ·å¸‚'; break;
            case 'æ¸': provinceName = 'é‡åº†å¸‚'; break;
            case 'å†€': provinceName = 'æ²³åŒ—çœ'; break;
            case 'æ™‹': provinceName = 'å±±è¥¿çœ'; break;
            case 'è’™': provinceName = 'å†…è’™å¤è‡ªæ²»åŒº'; break;
            case 'è¾½': provinceName = 'è¾½å®çœ'; break;
            case 'å‰': provinceName = 'å‰æ—çœ'; break;
            case 'é»‘': provinceName = 'é»‘é¾™æ±Ÿçœ'; break;
            case 'è‹': provinceName = 'æ±Ÿè‹çœ'; break;
            case 'æµ™': provinceName = 'æµ™æ±Ÿçœ'; break;
            case 'çš–': provinceName = 'å®‰å¾½çœ'; break;
            case 'é—½': provinceName = 'ç¦å»ºçœ'; break;
            case 'èµ£': provinceName = 'æ±Ÿè¥¿çœ'; break;
            case 'é²': provinceName = 'å±±ä¸œçœ'; break;
            case 'è±«': provinceName = 'æ²³å—çœ'; break;
            case 'é„‚': provinceName = 'æ¹–åŒ—çœ'; break;
            case 'æ¹˜': provinceName = 'æ¹–å—çœ'; break;
            case 'ç²¤': provinceName = 'å¹¿ä¸œçœ'; break;
            case 'æ¡‚': provinceName = 'å¹¿è¥¿å£®æ—è‡ªæ²»åŒº'; break;
            case 'ç¼': provinceName = 'æµ·å—çœ'; break;
            case 'å·': provinceName = 'å››å·çœ'; break;
            case 'è´µ': provinceName = 'è´µå·çœ'; break;
            case 'äº‘': provinceName = 'äº‘å—çœ'; break;
            case 'è—': provinceName = 'è¥¿è—è‡ªæ²»åŒº'; break;
            case 'é™•': provinceName = 'é™•è¥¿çœ'; break;
            case 'ç”˜': provinceName = 'ç”˜è‚ƒçœ'; break;
            case 'é’': provinceName = 'é’æµ·çœ'; break;
            case 'å®': provinceName = 'å®å¤å›æ—è‡ªæ²»åŒº'; break;
            case 'æ–°': provinceName = 'æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº'; break;
            default: provinceName = abbr;
          }
          
          const option = document.createElement('option');
          option.value = abbr; option.textContent = `${provinceName}(${abbr})`;
          provinceSelect.appendChild(option);
        }
        
        console.log('çœä»½ä¸‹æ‹‰æ¡†åˆå§‹åŒ–å®Œæˆï¼Œå…±åŠ è½½', Object.keys(provinceCityData).length, 'ä¸ªçœä»½');
      } catch (error) {
        console.error('åˆå§‹åŒ–çœä»½ä¸‹æ‹‰æ¡†å¤±è´¥:', error);
        showToast('çœä»½æ•°æ®åŠ è½½å¤±è´¥: ' + error.message, 'error');
      }
    }
    
    // åˆå§‹åŒ–åŸå¸‚å­—æ¯ä¸‹æ‹‰æ¡† - è¿”å›Promiseç¡®ä¿å¼‚æ­¥åŠ è½½å®Œæˆ
    function initCityLetterDropdown(provinceAbbr) {
      return new Promise((resolve, reject) => {
        try {
          const cityLetterSelect = document.getElementById('cityLetterSelect');
          if (!cityLetterSelect) {
            console.error('æœªæ‰¾åˆ°åŸå¸‚å­—æ¯é€‰æ‹©ä¸‹æ‹‰æ¡†');
            showToast('è·å–åŸå¸‚æ•°æ®å¤±è´¥', 'error');
            reject(new Error('æœªæ‰¾åˆ°åŸå¸‚å­—æ¯é€‰æ‹©ä¸‹æ‹‰æ¡†'));
            return;
          }
          
          // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ª"è¯·é€‰æ‹©å­—æ¯/åŸå¸‚"é€‰é¡¹ï¼‰
          while (cityLetterSelect.options.length > 1) {
            cityLetterSelect.remove(1);
          }
          
          if (!provinceAbbr) {
            resolve();
            return;
          }
          
          // è·å–è¯¥çœä»½å¯¹åº”çš„åŸå¸‚å­—æ¯æ•°æ®
          const cities = provinceCityData[provinceAbbr] || [];
          
          if (cities.length > 0) {
            cities.forEach(city => {
              const option = document.createElement('option');
              option.value = city.letter;
              option.textContent = `${city.letter}(${city.city})`;
              cityLetterSelect.appendChild(option);
            });
            console.log(`åŠ è½½${provinceAbbr}åŸå¸‚å­—æ¯æˆåŠŸï¼Œå…±${cities.length}ä¸ªé€‰é¡¹`);
            resolve();
          } else {
            console.warn(`æœªæ‰¾åˆ°${provinceAbbr}çš„åŸå¸‚æ•°æ®`);
            showToast('æœªæ‰¾åˆ°è¯¥çœä»½çš„åŸå¸‚æ•°æ®', 'warning');
            resolve();
          }
          
        } catch (error) {
          console.error('åˆå§‹åŒ–åŸå¸‚å­—æ¯ä¸‹æ‹‰æ¡†å¤±è´¥:', error);
          showToast('åŸå¸‚æ•°æ®åŠ è½½å¤±è´¥: ' + error.message, 'error');
          reject(error);
        }
      });
    }
    
    // é€šçŸ¥æ¸ é“å¤é€‰æ¡†äº¤äº’
    document.querySelectorAll('#notificationChannels input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        const channel = this.value;
        const configId = channel === 'wxpusher' ? 'wxpusherConfig' :
                        channel === 'wechat_work' ? 'wechatWorkConfig' : 
                        channel === 'dingtalk' ? 'dingtalkConfig' : 
                        channel === 'bark' ? 'barkConfig' : null;
        
        if (configId) {
          const configElement = document.getElementById(configId);
          configElement.style.display = this.checked ? 'block' : 'none';
        }
      });
    });
    
    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      try {
        console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        if (!localStorage.getItem('token')) {
          showToast('è¯·å…ˆç™»å½•ç³»ç»Ÿ', 'error');
          setTimeout(() => {
            window.location.href = '/admin/login.html';
          }, 3000);
          return;
        }
        
        // åº”ç”¨ä¿å­˜çš„ä¸»é¢˜
        const savedTheme = localStorage.getItem('theme') || 'light'; 
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        // åˆå§‹åŒ–çœä»½ä¸‹æ‹‰æ¡†
        initProvinceDropdown();
        
        // ç»‘å®šçœä»½ä¸‹æ‹‰æ¡†changeäº‹ä»¶
        document.getElementById('provinceSelect').addEventListener('change', function() {
          // æ˜¾ç¤ºåŠ è½½ä¸­æç¤º
          showToast('åŠ è½½åŸå¸‚æ•°æ®ä¸­...', 'info');
          initCityLetterDropdown(this.value).then(() => {
            hideLoading();
          }).catch(() => {
            hideLoading();
          });
        });
        
        // è½¦ç‰Œå·å‰©ä½™éƒ¨åˆ†è¾“å…¥å¤„ç†
        const remainingNumberInput = document.getElementById('remainingNumber');
        if (remainingNumberInput) {
          remainingNumberInput.addEventListener('input', function(e) {
            this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            
            // é™åˆ¶æœ€å¤§é•¿åº¦ä¸º6ä½ï¼ˆæ–°èƒ½æºè½¦ç‰Œï¼‰
            if (this.value.length > 6) {
              this.value = this.value.slice(0, 6);
            }
            
            // æ›´æ–°é•¿åº¦è®¡æ•°å™¨
            updatePlateLengthCounter();
          });
          
          // åˆå§‹åŒ–è®¡æ•°å™¨
          updatePlateLengthCounter();
        }
        
        // åŠ è½½è½¦ç‰Œæ•°æ®
        loadPlates();
        
        // åŠ è½½ç³»ç»Ÿè®¾ç½®
        loadSystemSettings();
        
        // æ·»åŠ å…¨å±€åˆ·æ–°å¿«æ·é”® (F5)
        document.addEventListener('keydown', function(e) {
          if (e.key === 'F5') {
            e.preventDefault();
            refreshPlates();
          }
        });
        
        console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
      } catch (error) {
        showToast('é¡µé¢åŠ è½½å¤±è´¥: ' + error.message, 'error');
        console.error('é¡µé¢åˆå§‹åŒ–é”™è¯¯:', error);
      }
    });
    
    // ç»‘å®šå…¨é€‰äº‹ä»¶
    function bindSelectAllEvent() {
      // å…¨é€‰å¤é€‰æ¡†äº‹ä»¶
      document.getElementById('selectAllLogs').addEventListener('change', function(e) { const checkboxes = document.querySelectorAll('#logsTableBody input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
      });
      
      // è¡¨å¤´å…¨é€‰å¤é€‰æ¡†åŒæ­¥
      document.getElementById('headerLogCheckbox').addEventListener('change', function(e) { 
        document.getElementById('selectAllLogs').checked = this.checked;
        const checkboxes = document.querySelectorAll('#logsTableBody input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
      });
    }
    
    // åŠ è½½æ—¥å¿—æ•°æ®
    async function loadLogs(page = 1, action = '') {
      try {
        currentLogsPage = page;
        const tableBody = document.getElementById('logsTableBody');
        const loading = document.getElementById('logsLoading');
        const emptyState = document.getElementById('logsEmptyState');
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        tableBody.innerHTML = '';
        loading.style.display = 'flex';
        emptyState.style.display = 'none';
        
        // æ„å»ºè¯·æ±‚URL
        let url = `/api/logs?page=${page}&limit=20`;
        if (action) {
          url += `&action=${encodeURIComponent(action)}`;
        }
        
        const response = await fetch(url, {
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          }
        });
        
        if (!response.ok) {
          if (response.status === 401 || response.status === 403) {
            localStorage.removeItem('token');
            showToast('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'error');
            setTimeout(() => {
              window.location.href = '/admin/login.html';
            }, 3000);
            return;
          }
          throw new Error('åŠ è½½æ—¥å¿—æ•°æ®å¤±è´¥');
        }
        
        const data = await response.json();
        
        // éšè—åŠ è½½çŠ¶æ€
        loading.style.display = 'none';
        
        // å¦‚æœæ²¡æœ‰æ—¥å¿—æ•°æ®ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
        if (data.logs.length === 0) {
          emptyState.style.display = 'block';
          return;
        }
        
        // æ¸²æŸ“æ—¥å¿—åˆ—è¡¨
        for (const log of data.logs) {
          const detailsHtml = formatLogDetails(log.details);
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><input type="checkbox" data-id="${log.id}"></td>
            <td>${log.action}</td>
            <td>${new Date(log.created_at).toLocaleString()}</td>
            <td>${log.ip}</td>
            <td>
              <div class="details-bubble">æŸ¥çœ‹è¯¦æƒ…
                <div class="details-popup">${detailsHtml}</div>
              </div>
            </td>
          `;
          tableBody.appendChild(row);
        }
        
        // æ¸²æŸ“åˆ†é¡µ
        renderPagination('logsPagination', data.pagination.pages, page);
        
        // é‡æ–°ç»‘å®šå…¨é€‰äº‹ä»¶
        bindSelectAllEvent();
        
      } catch (error) {
        console.error('åŠ è½½æ—¥å¿—é”™è¯¯:', error);
        showToast('åŠ è½½æ—¥å¿—å¤±è´¥: ' + error.message, 'error');
      } finally {
        console.log('åŠ è½½æ—¥å¿—å®Œæˆ');
      }
    }
    
    // æ ¼å¼åŒ–æ—¥å¿—è¯¦æƒ…ä¸ºHTML
    function formatLogDetails(details) {
      if (typeof details !== 'object' || details === null) {
        return `<div class="details-item">${details || 'æ— è¯¦æƒ…'}</div>`;
      }
      
      // ç®€åŒ–æ˜¾ç¤ºï¼Œåªæ˜¾ç¤ºå…³é”®ä¿¡æ¯
      let html = '<div style="text-align: left; font-size: 12px; line-height: 1.6;">';
      
      // æ˜¾ç¤ºè¯·æ±‚è·¯å¾„
      if (details.path) {
        html += `<div><strong>è·¯å¾„:</strong> ${details.path}</div>`;
      }
      
      // æ˜¾ç¤ºè¯·æ±‚æ–¹æ³•
      if (details.method) {
        html += `<div><strong>æ–¹æ³•:</strong> ${details.method}</div>`;
      }
      
      // æ˜¾ç¤ºçŠ¶æ€ç 
      if (details.statusCode) {
        const statusColor = details.statusCode >= 200 && details.statusCode < 300 ? '#28a745' : '#dc3545';
        html += `<div><strong>çŠ¶æ€:</strong> <span style="color: ${statusColor}">${details.statusCode}</span></div>`;
      }
      
      // æ˜¾ç¤ºè¯·æ±‚ä½“å…³é”®ä¿¡æ¯
      if (details.body && typeof details.body === 'object') {
        const body = details.body;
        if (body.plate) {
          html += `<div><strong>è½¦ç‰Œ:</strong> ${body.plate}</div>`;
        }
        if (body.phone) {
          html += `<div><strong>æ‰‹æœº:</strong> ${body.phone}</div>`;
        }
        if (body.username) {
          html += `<div><strong>ç”¨æˆ·:</strong> ${body.username}</div>`;
        }
      }
      
      // æ˜¾ç¤ºå“åº”æ¶ˆæ¯
      if (details.response) {
        try {
          const resp = typeof details.response === 'string' ? JSON.parse(details.response) : details.response;
          if (resp.msg) {
            html += `<div><strong>ç»“æœ:</strong> ${resp.msg}</div>`;
          }
        } catch (e) {
          // å¿½ç•¥è§£æé”™è¯¯
        }
      }
      
      // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
      if (details.error) {
        html += `<div style="color: #dc3545;"><strong>é”™è¯¯:</strong> ${details.error}</div>`;
      }
      
      html += '</div>';
      return html;
    }
    
    // åˆ‡æ¢æ ‡ç­¾é¡µ
    function switchTab(tabId) {
      try {
        console.log(`åˆ‡æ¢åˆ°æ ‡ç­¾é¡µ: ${tabId}`);
        
        // æ›´æ–°æ ‡ç­¾æ¿€æ´»çŠ¶æ€
        document.querySelectorAll('.tab').forEach(tab => {
          tab.classList.remove('active');
        });
        document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
        
        // æ›´æ–°å†…å®¹æ˜¾ç¤º
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(tabId).classList.add('active');
        
        // å¦‚æœåˆ‡æ¢åˆ°æ—¥å¿—æ ‡ç­¾é¡µï¼ŒåŠ è½½æ—¥å¿—æ•°æ®
        if (tabId === 'operation-logs') {
          loadLogs();
        }
      } catch (error) {
        showToast('åˆ‡æ¢æ ‡ç­¾å¤±è´¥: ' + error.message, 'error');
        console.error('åˆ‡æ¢æ ‡ç­¾é”™è¯¯:', error);
      }
    }
    
    // åˆ‡æ¢ä¸»é¢˜
    function toggleTheme() {
      try {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        showToast(`å·²åˆ‡æ¢åˆ°${newTheme === 'dark' ? 'æ·±è‰²' : 'æµ…è‰²'}ä¸»é¢˜`, 'success');
      } catch (error) {
        showToast('åˆ‡æ¢ä¸»é¢˜å¤±è´¥: ' + error.message, 'error');
        console.error('åˆ‡æ¢ä¸»é¢˜é”™è¯¯:', error);
      }
    }
    
    // åˆ·æ–°è½¦ç‰Œæ•°æ®
    function refreshPlates() {
      showLoading();
      showToast('æ•°æ®åˆ·æ–°ä¸­...', 'info');
      loadPlates(currentPlatesPage, currentSearchTerm).then(() => {
        hideLoading();
        showToast('æ•°æ®å·²æ›´æ–°', 'success');
        
        // æ»šåŠ¨åˆ°é¡¶éƒ¨
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }).catch(() => {
        hideLoading();
      });
    }
    
    // åŠ è½½è½¦ç‰Œæ•°æ®
    async function loadPlates(page = 1, search = '') {
      return new Promise(async (resolve, reject) => {
        currentPlatesPage = page;
        const tableBody = document.getElementById('platesTableBody');
        const loading = document.getElementById('platesLoading');
        const emptyState = document.getElementById('platesEmptyState');
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        tableBody.innerHTML = '';
        loading.style.display = 'flex';
        emptyState.style.display = 'none';
        
        try {
          console.log(`åŠ è½½è½¦ç‰Œæ•°æ®: ç¬¬${page}é¡µï¼Œæœç´¢è¯: ${search}`);
          
          // å¦‚æœæœ‰æœç´¢è¯ï¼Œä½¿ç”¨æœç´¢è¯ï¼Œå¦åˆ™ä½¿ç”¨ç©ºå­—ç¬¦ä¸²
          const searchParam = search ? `&search=${encodeURIComponent(search)}` : '';
          const url = `/api/plates?page=${page}&limit=10${searchParam}`;
          
          const response = await fetch(url, {
            headers: {
              'Authorization': 'Bearer ' + localStorage.getItem('token'),
              'Cache-Control': 'no-cache', // ç¦ç”¨ç¼“å­˜
              'Pragma': 'no-cache'
            }
          });
          
          if (!response.ok) {
            if (response.status === 401 || response.status === 403) {
              localStorage.removeItem('token');
              showToast('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'error');
              setTimeout(() => {
                window.location.href = '/admin/login.html';
              }, 3000);
              reject(new Error('ç™»å½•å·²è¿‡æœŸ'));
              return;
            }
            throw new Error('åŠ è½½è½¦ç‰Œæ•°æ®å¤±è´¥');
          }
          
          const data = await response.json();
          
          // éšè—åŠ è½½çŠ¶æ€
          loading.style.display = 'none';
          
          // å¦‚æœæ²¡æœ‰è½¦ç‰Œæ•°æ®ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
          if (data.plates.length === 0) {
            emptyState.style.display = 'block';
            resolve();
            return;
          }
          
          // æ¸²æŸ“è½¦ç‰Œåˆ—è¡¨
          for (const plate of data.plates) {
            // å¤„ç†UIDæ˜¾ç¤ºï¼Œéšè—ä¸­é—´éƒ¨åˆ†å­—ç¬¦
            const maskedUids = plate.uids.map(uid => {
              if (uid.length <= 7) {
                return '******'; // çŸ­UIDå…¨éƒ¨éšè—
              } // æ˜¾ç¤ºå‰3ä½å’Œå4ä½ï¼Œä¸­é—´ç”¨*ä»£æ›¿
              return uid.substring(0, 3) + '*****' + uid.substring(uid.length - 4);
            }).join(', ');
            
            // å¤„ç†é€šçŸ¥æ–¹å¼æ˜¾ç¤º
            const channels = plate.notification_channels || [];
            const channelLabels = {
              'wxpusher': 'WxPusher',
              'wechat_work': 'ä¼ä¸šå¾®ä¿¡',
              'dingtalk': 'é’‰é’‰',
              'bark': 'Bark'
            };
            const channelText = channels.map(c => channelLabels[c] || c).join(', ') || 'æœªè®¾ç½®';
            
            // åˆ›å»ºè¡Œå…ƒç´ å¹¶è®¾ç½®dataå±æ€§å­˜å‚¨å®Œæ•´çš„plateå¯¹è±¡
            const row = document.createElement('tr');
            row.dataset.plate = JSON.stringify(plate);
            row.innerHTML = `
              <td>${plate.plate}</td>
              <td>${maskedUids}</td>
              <td>${channelText}</td>
              <td>${plate.remark || '-'}</td>
              <td>${new Date(plate.created_at).toLocaleString()}</td>
              <td class="action-buttons">
                <button class="action-btn edit-btn" onclick="openEditPlateModal(this)">âœï¸ ç¼–è¾‘</button>
                <button class="action-btn delete-btn" onclick="deletePlate('${plate.id}', '${plate.plate}')">ğŸ—‘ï¸ åˆ é™¤</button>
                <button class="action-btn qrcode-btn" onclick="showQRCode('${plate.plate}')" style="background: #17a2b8; color: white;">ğŸ“± äºŒç»´ç </button>
              </td>
            `;
            tableBody.appendChild(row);
          }
          
          // æ¸²æŸ“åˆ†é¡µ
          renderPagination('platesPagination', data.pagination.pages, page);
          resolve();
        } catch (error) {
          loading.style.display = 'none';
          tableBody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: var(--danger);">åŠ è½½å¤±è´¥: ${error.message}</td></tr>`;
          showToast('åŠ è½½è½¦ç‰Œæ•°æ®å¤±è´¥: ' + error.message, 'error'); console.error('åŠ è½½è½¦ç‰Œé”™è¯¯:', error);
          reject(error);
        } finally {
          console.log('åŠ è½½è½¦ç‰Œå®Œæˆ');
        }
      });
    }
    
    // æ¸²æŸ“åˆ†é¡µæ§ä»¶
    function renderPagination(containerId, totalPages, currentPage) {
      try {
        console.log(`æ¸²æŸ“åˆ†é¡µ: æ€»é¡µæ•°${totalPages}, å½“å‰é¡µ${currentPage}`);
        
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        // å¦‚æœåªæœ‰ä¸€é¡µï¼Œä¸æ˜¾ç¤ºåˆ†é¡µ
        if (totalPages <= 1) {
          return;
        }
        
        // æ·»åŠ é¦–é¡µæŒ‰é’®
        if (currentPage > 1) {
          addPaginationButton(container, 1, 'é¦–é¡µ');
          
          // æ·»åŠ å‰ä¸€é¡µæŒ‰é’®
          addPaginationButton(container, currentPage - 1, 'ä¸Šä¸€é¡µ');
        }
        
        // æ·»åŠ é¡µç æŒ‰é’®ï¼ˆæ˜¾ç¤ºå½“å‰é¡µå‰å2é¡µï¼‰
        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, currentPage + 2);
        
        for (let i = startPage; i <= endPage; i++) {
          addPaginationButton(container, i, i, i === currentPage);
        }
        
        // æ·»åŠ ä¸‹ä¸€é¡µæŒ‰é’®
        if (currentPage < totalPages) {
          addPaginationButton(container, currentPage + 1, 'ä¸‹ä¸€é¡µ');
          
          // æ·»åŠ æœ«é¡µæŒ‰é’®
          addPaginationButton(container, totalPages, 'æœ«é¡µ');
        }
        
        console.log('åˆ†é¡µæ¸²æŸ“å®Œæˆ');
      } catch (error) {
        showToast('æ¸²æŸ“åˆ†é¡µå¤±è´¥: ' + error.message, 'error');
        console.error('æ¸²æŸ“åˆ†é¡µé”™è¯¯:', error);
      }
    }
    
    // æ·»åŠ åˆ†é¡µæŒ‰é’®
    function addPaginationButton(container, page, text, isActive = false) {
      const button = document.createElement('button');
      button.className = `pagination-btn ${isActive ? 'active' : ''}`;
      button.textContent = text;
      button.onclick = function() {
        showLoading();
        if (container.id === 'platesPagination') {
          loadPlates(page, currentSearchTerm).then(() => {
            hideLoading();
          }).catch(() => {
            hideLoading();
          });
        } else {
          loadLogs(page).then(() => {
            hideLoading();
          }).catch(() => {
            hideLoading(); });
        }
      };
      container.appendChild(button);
    }
    
    // æœç´¢è½¦ç‰Œ
    function searchPlates() {
      try {
        const searchTerm = document.getElementById('plateSearch').value.trim();
        currentSearchTerm = searchTerm;
        showLoading();
        loadPlates(1, searchTerm).then(() => {
          hideLoading();
          showToast(`æœç´¢ç»“æœ: "${searchTerm}"`, 'success');
        }).catch(() => {
          hideLoading();
        });
      } catch (error) {
        showToast('æœç´¢å¤±è´¥: ' + error.message, 'error');
        console.error('æœç´¢è½¦ç‰Œé”™è¯¯:', error);
      }
    }
    
    // é‡ç½®æœç´¢
    function resetSearch() {
      try {
        document.getElementById('plateSearch').value = '';
        currentSearchTerm = '';
        showLoading();
        loadPlates(1).then(() => {
          hideLoading();
          showToast('æœç´¢å·²é‡ç½®', 'success');
        }).catch(() => {
          hideLoading();
        });
      } catch (error) {
        showToast('é‡ç½®æœç´¢å¤±è´¥: ' + error.message, 'error');
        console.error('é‡ç½®æœç´¢é”™è¯¯:', error);
      }
    }
    
    // æ‰“å¼€æ·»åŠ è½¦ç‰Œæ¨¡æ€æ¡†
    function openAddPlateModal() {
      try {
        console.log('æ‰“å¼€æ·»åŠ è½¦ç‰Œæ¨¡æ€æ¡†');
        
        document.getElementById('plateModalTitle').textContent = 'æ·»åŠ è½¦ç‰Œ';
        document.getElementById('editPlateId').value = '';
        document.getElementById('provinceSelect').value = '';
        document.getElementById('cityLetterSelect').innerHTML = '<option value="">è¯·é€‰æ‹©å­—æ¯/åŸå¸‚</option>';
        document.getElementById('remainingNumber').value = '';
        document.getElementById('modalPlateRemark').value = '';
        document.getElementById('modalMessage').textContent = '';
        document.getElementById('modalMessage').className = 'message';
        
        // æ›´æ–°é•¿åº¦è®¡æ•°å™¨
        updatePlateLengthCounter();
        
        // é‡ç½®é€šçŸ¥æ¸ é“é€‰æ‹©
        resetNotificationChannels();
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        document.getElementById('plateModal').style.display = 'flex';
        
        // èšç„¦ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†
        setTimeout(() => {
          document.getElementById('provinceSelect').focus();
        }, 300);
        
      } catch (error) {
        showToast('æ‰“å¼€æ·»åŠ çª—å£å¤±è´¥: ' + error.message, 'error');
        console.error('æ‰“å¼€æ·»åŠ çª—å£é”™è¯¯:', error);
      }
    }
    
    // é‡ç½®é€šçŸ¥æ¸ é“é€‰æ‹©
    function resetNotificationChannels() {
      document.querySelectorAll('#notificationChannels input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      document.querySelectorAll('.notification-config-item').forEach(item => {
        item.style.display = 'none';
        // æ¸…ç©ºæ‰€æœ‰è¾“å…¥æ¡†
        item.querySelectorAll('input').forEach(input => {
          input.value = '';
        });
      });
    }
    
    // è®¾ç½®é€šçŸ¥æ¸ é“é…ç½®
    function setNotificationChannels(channels, configs, uids) {
      // WxPusheré…ç½®
      if (configs.wxpusher_token || channels.includes('wxpusher')) {
        document.getElementById('channelWxpusher').checked = true;
        document.getElementById('wxpusherConfig').style.display = 'block';
        document.getElementById('wxpusherToken').value = configs.wxpusher_token || '';
        // è®¾ç½®UID
        if (uids) {
          document.getElementById('modalPlateUid').value = Array.isArray(uids) ? uids.join(',') : uids;
        }
      }
      
      // ä¼ä¸šå¾®ä¿¡é…ç½®
      if (configs.wechat_work_webhook) {
        document.getElementById('channelWechatWork').checked = true;
        document.getElementById('wechatWorkConfig').style.display = 'block';
        document.getElementById('wechatWorkWebhook').value = configs.wechat_work_webhook;
      }
      
      // é’‰é’‰é…ç½®
      if (configs.dingtalk_webhook) {
        document.getElementById('channelDingtalk').checked = true;
        document.getElementById('dingtalkConfig').style.display = 'block';
        document.getElementById('dingtalkWebhook').value = configs.dingtalk_webhook;
      }
      
      // Barké…ç½®
      if (configs.bark_webhook) {
        document.getElementById('channelBark').checked = true;
        document.getElementById('barkConfig').style.display = 'block';
        document.getElementById('barkWebhook').value = configs.bark_webhook;
      }
      
      // å¤„ç†æ¸ é“å‹¾é€‰çŠ¶æ€
      channels.forEach(channel => { 
        const checkboxId = channel === 'wechat_work' ? 'channelWechatWork' : 
                          channel === 'wxpusher' ? 'channelWxpusher' :
                          channel === 'dingtalk' ? 'channelDingtalk' :
                          channel === 'bark' ? 'channelBark' : null;
        if (checkboxId) {
          document.getElementById(checkboxId).checked = true;
          // æ˜¾ç¤ºå¯¹åº”é…ç½®
          const configId = channel === 'wxpusher' ? 'wxpusherConfig' :
                          channel === 'wechat_work' ? 'wechatWorkConfig' :
                          channel === 'dingtalk' ? 'dingtalkConfig' :
                          channel === 'bark' ? 'barkConfig' : null;
          if (configId) {
            document.getElementById(configId).style.display = 'block';
          }
        }
      });
    }
    
    // æ‰“å¼€ç¼–è¾‘è½¦ç‰Œæ¨¡æ€æ¡†
    function openEditPlateModal(button) {
      try {
        // è·å–å®Œæ•´çš„plateå¯¹è±¡
        const row = button.closest('tr');
        if (!row) {
          console.error('æœªæ‰¾åˆ°æŒ‰é’®æ‰€åœ¨çš„è¡Œå…ƒç´ ');
          showToast('è·å–æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
          return;
        }
        
        const plateData = row.dataset.plate;
        if (!plateData) {
          console.error('æœªæ‰¾åˆ°è¡Œå…ƒç´ ä¸­çš„è½¦ç‰Œæ•°æ®');
          showToast('è·å–æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
          return;
        }
        
        const plate = JSON.parse(plateData);
        console.log(`æ‰“å¼€ç¼–è¾‘è½¦ç‰Œæ¨¡æ€æ¡†: ${plate.plate}`, plate);
        
        document.getElementById('plateModalTitle').textContent = 'ç¼–è¾‘è½¦ç‰Œ';
        document.getElementById('editPlateId').value = plate.id;
        document.getElementById('modalPlateRemark').value = plate.remark || '';
        document.getElementById('modalMessage').textContent = '';
        
        // æ‹†åˆ†è½¦ç‰Œå·ä¸ºçœä»½ã€åŸå¸‚å­—æ¯å’Œå‰©ä½™å·ç 
        const plateNumber = plate.plate;
        if (plateNumber.length >= 2) {
          const provinceAbbr = plateNumber.substring(0, 1);
          const cityLetter = plateNumber.substring(1, 2);
          const remainingNumber = plateNumber.substring(2);
          
          console.log(`è§£æè½¦ç‰Œå·: ${plateNumber} -> çœä»½: ${provinceAbbr}, å­—æ¯: ${cityLetter}, å‰©ä½™: ${remainingNumber}`);
          
          // è®¾ç½®ä¸‹æ‹‰æ¡†å’Œè¾“å…¥æ¡†çš„å€¼
          const provinceSelect = document.getElementById('provinceSelect');
          if (provinceSelect) {
            provinceSelect.value = provinceAbbr;
            
            // åŠ è½½åŸå¸‚æ•°æ®å¹¶è®¾ç½®åŸå¸‚å­—æ¯ä¸‹æ‹‰æ¡†
            showLoading();
            initCityLetterDropdown(provinceAbbr).then(() => { 
              const cityLetterSelect = document.getElementById('cityLetterSelect'); 
              if (cityLetterSelect) {
                cityLetterSelect.value = cityLetter;
              }
              document.getElementById('remainingNumber').value = remainingNumber;
              updatePlateLengthCounter();
              hideLoading();
            }).catch(() => {
              hideLoading();
            });
          }
        }
        
        // é‡ç½®é€šçŸ¥æ¸ é“é€‰æ‹©å¹¶è®¾ç½®å¤é€‰æ¡†çŠ¶æ€å’Œé…ç½®å€¼
        resetNotificationChannels();
        setNotificationChannels(plate.notification_channels || [], plate.notification_configs || {}, plate.uids);
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        document.getElementById('plateModal').style.display = 'flex';
        
        // èšç„¦ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†
        setTimeout(() => {
          document.getElementById('provinceSelect').focus();
        }, 300);
        
      } catch (error) {
        showToast('æ‰“å¼€ç¼–è¾‘çª—å£å¤±è´¥: ' + error.message, 'error');
        console.error('ç¼–è¾‘çª—å£æ‰“å¼€å¤±è´¥è¯¦æƒ…:', error);
      }
    }
    
    // å…³é—­è½¦ç‰Œæ¨¡æ€æ¡†
    function closePlateModal() {
      try {
        document.getElementById('plateModal').style.display = 'none';
      } catch (error) {
        showToast('å…³é—­çª—å£å¤±è´¥: ' + error.message, 'error');
        console.error('å…³é—­çª—å£é”™è¯¯:', error);
      }
    }
    
    // äºŒç»´ç ç›¸å…³å˜é‡
    let currentQRCodePlate = '';
    
    // æ˜¾ç¤ºäºŒç»´ç å¼¹çª—
    function showQRCode(plate) {
      currentQRCodePlate = plate;
      document.getElementById('qrcodePlate').textContent = plate;
      const scanUrl = window.location.origin + '/admin/scan.html?plate=' + encodeURIComponent(plate);
      document.getElementById('qrcodeLink').value = scanUrl;
      document.getElementById('qrcodeModal').style.display = 'flex';
    }
    
    // å…³é—­äºŒç»´ç å¼¹çª—
    function closeQRCodeModal() {
      document.getElementById('qrcodeModal').style.display = 'none';
    }
    
    // å¤åˆ¶äºŒç»´ç é“¾æ¥
    function copyQRCodeLink() {
      const scanUrl = document.getElementById('qrcodeLink').value;
      
      navigator.clipboard.writeText(scanUrl).then(() => {
        showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
      }).catch(() => {
        // é™çº§æ–¹æ¡ˆ
        const input = document.getElementById('qrcodeLink');
        input.select();
        document.execCommand('copy');
        showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
      });
    }
    
    // ä¿å­˜è½¦ç‰Œï¼ˆæ·»åŠ æˆ–ç¼–è¾‘ï¼‰
    async function savePlate() {
      try {
        const plateId = document.getElementById('editPlateId').value;
        const provinceAbbr = document.getElementById('provinceSelect').value;
        const cityLetter = document.getElementById('cityLetterSelect').value;
        const remainingNumber = document.getElementById('remainingNumber').value.trim();
        const uids = document.getElementById('modalPlateUid').value.trim();
        const remark = document.getElementById('modalPlateRemark').value.trim();
        const messageEl = document.getElementById('modalMessage');
        
        console.log(`ä¿å­˜è½¦ç‰Œ: ${plateId ? 'ç¼–è¾‘' : 'æ·»åŠ '}`);
        
        // éªŒè¯è¾“å…¥
        if (!provinceAbbr) {
          messageEl.textContent = 'è¯·é€‰æ‹©çœä»½';
          messageEl.className = 'message error';
          document.getElementById('provinceSelect').focus();
          return;
        }
        
        if (!cityLetter) {
          messageEl.textContent = 'è¯·é€‰æ‹©å­—æ¯/åŸå¸‚';
          messageEl.className = 'message error';
          document.getElementById('cityLetterSelect').focus();
          return;
        }
        
        if (!remainingNumber) {
          messageEl.textContent = 'è¯·è¾“å…¥è½¦ç‰Œå·å5-6ä½';
          messageEl.className = 'message error';
          document.getElementById('remainingNumber').focus();
          return;
        }
        
        // éªŒè¯é•¿åº¦
        if (remainingNumber.length < 5 || remainingNumber.length > 6) {
          messageEl.textContent = 'è½¦ç‰Œå·å5-6ä½æ ¼å¼ä¸æ­£ç¡®ï¼Œæ™®é€šè½¦ç‰Œ5ä½ï¼Œæ–°èƒ½æºè½¦ç‰Œ6ä½';
          messageEl.className = 'message error';
          document.getElementById('remainingNumber').focus();
          return;
        }
        
        // ç»„åˆæˆå®Œæ•´è½¦ç‰Œå·
        const plateNumber = provinceAbbr + cityLetter + remainingNumber;
        
        // éªŒè¯è½¦ç‰Œæ ¼å¼
        if (!plateRegex.test(plateNumber)) {
          let errorMsg = 'è½¦ç‰Œå·æ ¼å¼ä¸æ­£ç¡®';
          
          if (plateNumber.length === 7) {
            errorMsg += 'ï¼Œæ™®é€šè½¦ç‰Œåº”ä¸º7ä½ï¼ˆçœä»½ç®€ç§°+å­—æ¯+5ä½åºå·ï¼‰';
          } else if (plateNumber.length === 8) {
            errorMsg += 'ï¼Œæ–°èƒ½æºè½¦ç‰Œåº”ä¸º8ä½ï¼ˆçœä»½ç®€ç§°+å­—æ¯+6ä½åºå·ï¼‰';
          } else {
            errorMsg += `ï¼Œé•¿åº¦åº”ä¸º${remainingNumber.length === 5 ? '7' : '8'}ä½`;
          }
          
          errorMsg += `ï¼Œå½“å‰è½¦ç‰Œå·: ${plateNumber}`;
          messageEl.textContent = errorMsg;
          messageEl.className = 'message error';
          return;
        }
        
        if (!uids) {
          messageEl.textContent = 'è¯·è¾“å…¥ç”¨æˆ·UID';
          messageEl.className = 'message error';
          document.getElementById('modalPlateUid').focus();
          return;
        }
        
        // æ”¶é›†é€šçŸ¥æ¸ é“é…ç½®
        const channels = [];
        const configs = {};
        
        // WxPusheré…ç½®
        if (document.getElementById('channelWxpusher').checked) {
          const token = document.getElementById('wxpusherToken').value.trim();
          if (!token) {
            messageEl.textContent = 'è¯·è¾“å…¥WxPusher APP Token';
            messageEl.className = 'message error';
            document.getElementById('wxpusherToken').focus();
            return;
          }
          channels.push('wxpusher');
          configs.wxpusher_token = token;
        }
        
        // ä¼ä¸šå¾®ä¿¡é…ç½®
        if (document.getElementById('channelWechatWork').checked) {
          const webhook = document.getElementById('wechatWorkWebhook').value.trim();
          if (!webhook) {
            messageEl.textContent = 'è¯·è¾“å…¥ä¼ä¸šå¾®ä¿¡Webhookåœ°å€';
            messageEl.className = 'message error';
            document.getElementById('wechatWorkWebhook').focus();
            return;
          }
          channels.push('wechat_work');
          configs.wechat_work_webhook = webhook;
        }
        
        // é’‰é’‰é…ç½®
        if (document.getElementById('channelDingtalk').checked) {
          const webhook = document.getElementById('dingtalkWebhook').value.trim();
          if (!webhook) {
            messageEl.textContent = 'è¯·è¾“å…¥é’‰é’‰Webhookåœ°å€';
            messageEl.className = 'message error';
            document.getElementById('dingtalkWebhook').focus();
            return;
          }
          channels.push('dingtalk');
          configs.dingtalk_webhook = webhook;
        }
        
        // Barké…ç½®
        if (document.getElementById('channelBark').checked) {
          const webhook = document.getElementById('barkWebhook').value.trim();
          if (!webhook) {
            messageEl.textContent = 'è¯·è¾“å…¥BarkæœåŠ¡å™¨åœ°å€';
            messageEl.className = 'message error';
            document.getElementById('barkWebhook').focus();
            return;
          }
          channels.push('bark');
          configs.bark_webhook = webhook;
        }
        
        if (channels.length === 0) {
          messageEl.textContent = 'è¯·è‡³å°‘é€‰æ‹©ä¸€ç§é€šçŸ¥æ¸ é“';
          messageEl.className = 'message error';
          return;
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        const saveButton = document.getElementById('savePlateBtn');
        const originalText = saveButton.innerHTML;
        saveButton.disabled = true;
        saveButton.innerHTML = '<div class="loading" style="width: 16px; height: 16px;"></div> å¤„ç†ä¸­...';
        
        try {
          const response = await fetch(plateId ? `/api/plates/${plateId}` : '/api/plates', {
            method: plateId ? 'PUT' : 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer ' + localStorage.getItem('token')
            },
            body: JSON.stringify({
              plate: plateNumber,
              uids: uids.split(',').map(uid => uid.trim()),
              remark: remark,
              notification_channels: channels,
              notification_configs: configs
            })
          });
          
          // æ— è®ºå“åº”çŠ¶æ€å¦‚ä½•ï¼Œå…ˆå°è¯•è§£æJSONå“åº”
          let data;
          try {
            data = await response.json();
          } catch (jsonError) {
            // å¤„ç†éJSONå“åº”
            throw new Error(`æœåŠ¡å™¨è¿”å›æ— æ•ˆå“åº”: ${await response.text()}`);
          }
          
          if (response.ok) {
            const successMsg = plateId ? 'è½¦ç‰Œæ›´æ–°æˆåŠŸ' : 'è½¦ç‰Œæ·»åŠ æˆåŠŸ';
            messageEl.textContent = successMsg;
            messageEl.className = 'message success';
            
            // ä½¿ç”¨showSuccessæ˜¾ç¤ºæˆåŠŸæç¤º
            showToast(successMsg, 'success');
            
            // å…³é—­æ¨¡æ€æ¡†å¹¶é‡æ–°åŠ è½½è½¦ç‰Œæ•°æ®
            setTimeout(() => {
              closePlateModal();
              refreshPlates(); // ä½¿ç”¨å¼ºåˆ¶åˆ·æ–°
            }, 1000);
          } else {
            // è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å¤„ç†
            messageEl.textContent = `æ“ä½œå¤±è´¥: ${data.msg || 'æœªçŸ¥é”™è¯¯'}`;
            messageEl.className = 'message error';
            
            // ç‰¹å®šé”™è¯¯ç±»å‹çš„è¯¦ç»†æç¤º
            if (response.status === 401 || response.status === 403) {
              messageEl.textContent += '\nç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•';
              setTimeout(() => {
                logout();
              }, 3000);
            } else if (response.status === 409) {
              messageEl.textContent = 'è¯¥è½¦ç‰Œå·å·²å­˜åœ¨ï¼Œè¯·æ›´æ¢è½¦ç‰Œå·';
            }
          }
        } catch (error) {
          // ç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸
          messageEl.textContent = `è¯·æ±‚å¤±è´¥: ${error.message}`;
          messageEl.className = 'message error';
          console.error('ä¿å­˜è½¦ç‰Œè¯·æ±‚é”™è¯¯:', error);
        } finally {
          // æ¢å¤æŒ‰é’®çŠ¶æ€
          saveButton.disabled = false;
          saveButton.innerHTML = originalText;
        }
      } catch (error) {
        showToast('ä¿å­˜è½¦ç‰Œå¤±è´¥: ' + error.message, 'error');
        console.error('ä¿å­˜è½¦ç‰Œå¼‚å¸¸:', error);
      }
    }
    
    // åˆ é™¤è½¦ç‰Œ
    async function deletePlate(id, plateNumber) {
      try {
        if (!confirm(`ç¡®å®šè¦åˆ é™¤è½¦ç‰Œå· ${plateNumber} å—ï¼Ÿ\nåˆ é™¤åå°†æ— æ³•æ¢å¤ï¼`)) {
          return;
        }
        
        console.log(`åˆ é™¤è½¦ç‰Œ: ${plateNumber} (ID: ${id})`);
        
        // ä¹è§‚æ›´æ–° - ç«‹å³ä»UIä¸­ç§»é™¤è¯¥è®°å½•
        const rows = document.querySelectorAll('#platesTableBody tr');
        for (const row of rows) {
          const dataPlate = JSON.parse(row.dataset.plate);
          if (dataPlate.id === id) {
            // æ·»åŠ åˆ é™¤åŠ¨ç”»
            row.style.opacity = '0.5';
            row.style.transform = 'translateX(-10px)';
            row.style.transition = 'all 0.3s ease';
            break;
          }
        }
        
        const response = await fetch(`/api/plates/${id}`, {
          method: 'DELETE',
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          } 
        });
        
        // æ— è®ºå“åº”çŠ¶æ€å¦‚ä½•ï¼Œéƒ½å°è¯•åˆ·æ–°æ•°æ®
        try {
          const data = await response.json();
          console.log('åˆ é™¤å“åº”:', response.status, data);
          
          if (response.ok) {
            showToast('è½¦ç‰Œåˆ é™¤æˆåŠŸ', 'success');
          } else {
            showToast(`åˆ é™¤å¤±è´¥: ${data.msg || 'æœªçŸ¥é”™è¯¯'}`, 'error');
          }
        } catch (jsonError) {
          console.error('è§£æåˆ é™¤å“åº”å¤±è´¥:', jsonError);
          if (response.ok) {
            showToast('è½¦ç‰Œåˆ é™¤æˆåŠŸ', 'success');
          } else {
            showToast(`åˆ é™¤å¤±è´¥: HTTPçŠ¶æ€ ${response.status}`, 'error');
          }
        }
        
        // å¼ºåˆ¶åˆ·æ–°æ•°æ®ï¼Œç¡®ä¿ç”¨æˆ·çœ‹åˆ°æœ€æ–°çŠ¶æ€
        refreshPlates();
        
      } catch (error) {
        showToast('åˆ é™¤è½¦ç‰Œå¤±è´¥: ' + error.message, 'error');
        console.error('åˆ é™¤è½¦ç‰Œé”™è¯¯:', error);
        
        // å³ä½¿è¯·æ±‚å¤±è´¥ä¹Ÿå°è¯•åˆ·æ–°æ•°æ®
        refreshPlates();
      }
    }
    
    // ç”¨æˆ·é€€å‡ºç™»å½•
    function logout() {
      try {
        if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
          localStorage.removeItem('token');
          window.location.href = '/admin/login.html';
        }
      } catch (error) {
        showToast('é€€å‡ºç™»å½•å¤±è´¥: ' + error.message, 'error');
        console.error('é€€å‡ºç™»å½•é”™è¯¯:', error);
      }
    }
    
    // åŠ è½½ç³»ç»Ÿè®¾ç½®
    async function loadSystemSettings() {
      try { 
        showLoading();
        // ç³»ç»Ÿè®¾ç½®é¡µé¢åªæœ‰å¯†ç ä¿®æ”¹ï¼Œæ— éœ€åŠ è½½æ•°æ®
      } catch (error) {
        showToast('åŠ è½½ç³»ç»Ÿè®¾ç½®å¤±è´¥: ' + error.message, 'error');
        console.error('åŠ è½½ç³»ç»Ÿè®¾ç½®é”™è¯¯:', error);
      } finally {
        hideLoading();
      }
    }
    
    // Save system settings
    async function saveSystemSettings() {
      try {
        showLoading();
        const adminPassword = document.getElementById('adminPassword').value.trim();
        const messageEl = document.getElementById('settingsMessage');
        
        const settings = {};
        if (adminPassword) settings.admin_password = adminPassword;
        
        if (Object.keys(settings).length === 0) {
          messageEl.textContent = 'è¯·è¾“å…¥æ–°å¯†ç '; messageEl.className = 'message info';
          hideLoading();
          return; }
        
        const response = await fetch('/api/system-settings', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('token') || ''
          },
          body: JSON.stringify(settings)
        });
        
        const data = await response.json();
        
        if (response.ok) {
          messageEl.textContent = 'å¯†ç ä¿®æ”¹æˆåŠŸ';
          messageEl.className = 'message success';
          showToast('å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•', 'success');
          
          // ä¿®æ”¹å¯†ç åæç¤ºé‡æ–°ç™»å½•
          setTimeout(() => {
            logout();
          }, 2000);
        } else {
          messageEl.textContent = data.msg || 'ä¿å­˜å¤±è´¥';
          messageEl.className = 'message error';
          showToast(`ä¿å­˜å¤±è´¥: ${data.msg || 'æœªçŸ¥é”™è¯¯'}`, 'error');
        }
      } catch (error) {
        showToast('ä¿å­˜ç³»ç»Ÿè®¾ç½®å¤±è´¥: ' + error.message, 'error');
        console.error('ä¿å­˜ç³»ç»Ÿè®¾ç½®é”™è¯¯:', error);
      } finally {
        hideLoading();
      }
    }
    
    // æœç´¢æ—¥å¿—
    function searchLogs() {
      try {
        const searchTerm = document.getElementById('logSearch').value.trim();
        showLoading();
        loadLogs(1, searchTerm).then(() => {
          hideLoading();
          showToast(`æ—¥å¿—æœç´¢ç»“æœ: "${searchTerm}"`, 'success');
        }).catch(() => {
          hideLoading();
        });
      } catch (error) {
        showToast('æœç´¢æ—¥å¿—å¤±è´¥: ' + error.message, 'error');
        console.error('æœç´¢æ—¥å¿—é”™è¯¯:', error);
      }
    }
    
    // åˆ é™¤é€‰ä¸­æ—¥å¿—
    async function deleteSelectedLogs() {
      try {
        const selectedCheckboxes = document.querySelectorAll('#logsTableBody input[type="checkbox"]:checked');
        if (selectedCheckboxes.length === 0) {
          showToast('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ—¥å¿—', 'warning');
          return;
        }
        
        if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedCheckboxes.length} æ¡æ—¥å¿—å—ï¼Ÿ`)) {
          return;
        }
        
        showLoading();
        const ids = Array.from(selectedCheckboxes).map(checkbox => checkbox.getAttribute('data-id'));
        
        const response = await fetch('/api/logs', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          },
          body: JSON.stringify({ ids: ids })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          showToast(`æˆåŠŸåˆ é™¤ ${data.deletedCount} æ¡æ—¥å¿—`, 'success');
          loadLogs(currentLogsPage);
        } else {
          showToast(data.msg || 'åˆ é™¤æ—¥å¿—å¤±è´¥', 'error');
        }
      } catch (error) {
        showToast('åˆ é™¤æ—¥å¿—å¤±è´¥: ' + error.message, 'error');
        console.error('åˆ é™¤æ—¥å¿—é”™è¯¯:', error);
      } finally {
        hideLoading();
      }
    }
  </script>
</body>
</html>
